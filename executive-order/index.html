<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EXECUTIVE ORDER ‚Äî Strategy Game | UFCR</title>
  <meta name="description" content="Sign executive orders. Shape the nation. Survive the chaos.">
  <link rel="icon" href="../assets/images/shield-logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Oswald:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <style>
    :root {
      --blue: #0021A5;
      --orange: #FA4616;
      --gold: #F0A830;
      --white: #FFFFFF;
      --navy: #001845;
      --dark: #0A0E1A;
      --green: #34C759;
      --red: #FF3B30;
      --purple: #AF52DE;
      --cyan: #32D4DE;
      --font-body: 'Inter', -apple-system, sans-serif;
      --font-heading: 'Oswald', 'Inter', sans-serif;
      --ease: cubic-bezier(0.22, 1, 0.36, 1);
    }
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { -webkit-font-smoothing: antialiased; font-size: 16px; }
    body { font-family: var(--font-body); background: var(--dark); color: var(--white); overflow-x: hidden; min-height: 100vh; }
    a { text-decoration: none; color: inherit; }

    .nav {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100; height: 56px;
      background: rgba(0,24,69,0.95); backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .nav-inner {
      max-width: 1200px; margin: 0 auto; padding: 0 16px; height: 100%;
      display: flex; align-items: center; justify-content: space-between;
    }
    .nav-logo { display: flex; align-items: center; gap: 8px; }
    .nav-logo img { height: 32px; border-radius: 6px; background: white; padding: 2px; }
    .nav-logo span { font-family: var(--font-heading); font-size: 1.1rem; font-weight: 700; letter-spacing: 0.08em; }
    .nav-back { font-size: 0.8rem; font-weight: 500; color: rgba(255,255,255,0.5); transition: color 0.3s; }
    .nav-back:hover { color: var(--gold); }

    .screen { display: none; }
    .screen.active { display: flex; flex-direction: column; align-items: center; }

    /* TITLE */
    #title-screen {
      justify-content: center; min-height: 100vh; padding: 80px 20px 40px;
      background: radial-gradient(ellipse at 50% 30%, rgba(0,33,165,0.3) 0%, transparent 60%);
    }
    .title-seal {
      width: 120px; height: 120px; border-radius: 50%;
      background: linear-gradient(135deg, var(--gold) 0%, #D4912A 100%);
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 0 60px rgba(240,168,48,0.3), 0 8px 32px rgba(0,0,0,0.4);
      margin-bottom: 28px; animation: sealPulse 3s ease-in-out infinite;
    }
    @keyframes sealPulse {
      0%, 100% { box-shadow: 0 0 60px rgba(240,168,48,0.3), 0 8px 32px rgba(0,0,0,0.4); }
      50% { box-shadow: 0 0 80px rgba(240,168,48,0.5), 0 8px 32px rgba(0,0,0,0.4); }
    }
    .title-seal i { font-size: 3rem; color: var(--dark); }
    .title-heading {
      font-family: var(--font-heading); font-size: clamp(2.2rem, 6vw, 3.5rem);
      font-weight: 700; letter-spacing: 0.06em; text-align: center;
      background: linear-gradient(135deg, var(--white) 0%, var(--gold) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      margin-bottom: 12px;
    }
    .title-sub {
      font-size: 1rem; color: rgba(255,255,255,0.45); text-align: center;
      max-width: 440px; line-height: 1.6; margin-bottom: 36px;
    }
    .btn-primary {
      padding: 14px 44px; border: none; border-radius: 12px; cursor: pointer;
      font-family: var(--font-heading); font-size: 1.2rem; font-weight: 600;
      letter-spacing: 0.08em; color: var(--dark);
      background: linear-gradient(135deg, var(--gold) 0%, #FFD060 100%);
      box-shadow: 0 4px 24px rgba(240,168,48,0.4);
      transition: transform 0.3s var(--ease), box-shadow 0.3s var(--ease);
    }
    .btn-primary:hover { transform: translateY(-2px) scale(1.03); box-shadow: 0 8px 32px rgba(240,168,48,0.6); }
    .btn-primary:active { transform: scale(0.97); }

    /* GAME */
    #game-screen { padding: 64px 12px 20px; min-height: 100vh; width: 100%; }

    /* HUD TOP ROW */
    .hud-top {
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      width: 100%; max-width: 720px; margin-bottom: 10px; flex-wrap: wrap;
    }
    .day-banner {
      font-family: var(--font-heading); font-size: 0.85rem; letter-spacing: 0.12em;
      color: var(--gold); opacity: 0.8;
    }
    .term-badge {
      font-size: 0.7rem; padding: 3px 10px; border-radius: 6px;
      background: rgba(240,168,48,0.15); color: var(--gold);
      font-weight: 600; letter-spacing: 0.08em;
    }
    .budget-display {
      display: flex; align-items: center; gap: 6px; font-family: var(--font-heading);
      font-size: 0.95rem; color: var(--cyan);
    }
    .budget-display i { font-size: 0.75rem; }

    /* STAT BARS */
    .hud {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;
      width: 100%; max-width: 720px; margin-bottom: 8px;
    }
    .hud-card {
      background: rgba(255,255,255,0.05); border-radius: 10px; padding: 10px 8px;
      text-align: center; border: 1px solid rgba(255,255,255,0.06);
      transition: border-color 0.5s, background 0.5s;
    }
    .hud-card.pulse-up { border-color: rgba(52,199,89,0.5); background: rgba(52,199,89,0.08); }
    .hud-card.pulse-down { border-color: rgba(255,59,48,0.5); background: rgba(255,59,48,0.08); }
    .hud-label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.1em; color: rgba(255,255,255,0.35); margin-bottom: 2px; }
    .hud-value { font-family: var(--font-heading); font-size: 1.3rem; font-weight: 700; transition: color 0.3s; }
    .hud-bar { width: 100%; height: 4px; border-radius: 2px; background: rgba(255,255,255,0.08); margin-top: 4px; overflow: hidden; }
    .hud-bar-fill { height: 100%; border-radius: 2px; transition: width 0.8s var(--ease), background 0.4s; }

    /* FACTION ROW */
    .factions {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;
      width: 100%; max-width: 720px; margin-bottom: 16px;
    }
    .faction {
      background: rgba(255,255,255,0.03); border-radius: 8px; padding: 8px 6px;
      text-align: center; border: 1px solid rgba(255,255,255,0.04);
      transition: border-color 0.5s, background 0.5s;
    }
    .faction.hostile { border-color: rgba(255,59,48,0.4); background: rgba(255,59,48,0.06); }
    .faction.friendly { border-color: rgba(52,199,89,0.3); background: rgba(52,199,89,0.04); }
    .faction-icon { font-size: 1rem; margin-bottom: 2px; }
    .faction-name { font-size: 0.55rem; text-transform: uppercase; letter-spacing: 0.08em; color: rgba(255,255,255,0.35); }
    .faction-val { font-family: var(--font-heading); font-size: 0.9rem; font-weight: 600; }
    .faction-bar { width: 80%; height: 3px; border-radius: 2px; background: rgba(255,255,255,0.06); margin: 3px auto 0; overflow: hidden; }
    .faction-bar-fill { height: 100%; border-radius: 2px; transition: width 0.8s var(--ease); background: var(--gold); }

    /* ORDER AREA */
    .order-area {
      width: 100%; max-width: 720px; position: relative; min-height: 280px;
      display: flex; align-items: flex-start; justify-content: center;
    }
    .order-card {
      width: 100%; max-width: 520px; border-radius: 14px; overflow: hidden;
      background: linear-gradient(145deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.03) 100%);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 6px 32px rgba(0,0,0,0.3);
    }
    .order-header {
      padding: 16px 20px 12px; display: flex; align-items: center; gap: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .order-icon {
      width: 42px; height: 42px; border-radius: 10px; display: flex;
      align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0;
    }
    .order-category { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.1em; color: rgba(255,255,255,0.35); }
    .order-title { font-family: var(--font-heading); font-size: 1.05rem; font-weight: 600; margin-top: 1px; }

    .order-body { padding: 16px 20px; }
    .order-desc { font-size: 0.85rem; line-height: 1.6; color: rgba(255,255,255,0.6); margin-bottom: 12px; }
    .order-cost {
      display: inline-flex; align-items: center; gap: 5px; font-size: 0.75rem;
      padding: 4px 10px; border-radius: 6px; margin-bottom: 12px;
      background: rgba(50,212,222,0.12); color: var(--cyan); font-weight: 600;
    }
    .order-effects { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 14px; }
    .order-effect {
      font-size: 0.7rem; padding: 3px 8px; border-radius: 5px;
      font-weight: 500; display: flex; align-items: center; gap: 3px;
    }
    .order-effect.positive { background: rgba(52,199,89,0.12); color: var(--green); }
    .order-effect.negative { background: rgba(255,59,48,0.12); color: var(--red); }

    /* ADVISORS */
    .advisor-section { margin-bottom: 14px; }
    .advisor-section-title { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.1em; color: rgba(255,255,255,0.25); margin-bottom: 8px; }
    .advisor-quotes { display: flex; flex-direction: column; gap: 6px; }
    .advisor-quote {
      display: flex; align-items: flex-start; gap: 8px; padding: 8px 10px;
      border-radius: 8px; background: rgba(255,255,255,0.03);
      border-left: 3px solid;
    }
    .advisor-avatar {
      width: 28px; height: 28px; border-radius: 50%; display: flex;
      align-items: center; justify-content: center; font-size: 0.75rem;
      flex-shrink: 0; font-weight: 700;
    }
    .advisor-name { font-size: 0.65rem; font-weight: 600; margin-bottom: 1px; }
    .advisor-text { font-size: 0.75rem; line-height: 1.45; color: rgba(255,255,255,0.5); font-style: italic; }

    .order-actions { padding: 12px 20px 20px; display: flex; gap: 10px; }
    .btn-sign, .btn-veto {
      flex: 1; padding: 12px; border: none; border-radius: 10px; cursor: pointer;
      font-family: var(--font-heading); font-size: 0.95rem; font-weight: 600;
      letter-spacing: 0.06em; transition: transform 0.2s, box-shadow 0.3s, opacity 0.3s;
    }
    .btn-sign {
      background: linear-gradient(135deg, var(--green), #2AA84B);
      color: white; box-shadow: 0 4px 16px rgba(52,199,89,0.3);
    }
    .btn-veto {
      background: linear-gradient(135deg, var(--red), #D42A20);
      color: white; box-shadow: 0 4px 16px rgba(255,59,48,0.3);
    }
    .btn-sign:hover, .btn-veto:hover { transform: translateY(-2px); }
    .btn-sign:active, .btn-veto:active { transform: scale(0.96); }
    .btn-sign:disabled, .btn-veto:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

    /* CRISIS OVERLAY */
    .crisis-overlay {
      position: fixed; inset: 0; z-index: 300; display: none;
      align-items: center; justify-content: center; padding: 20px;
      background: rgba(0,0,0,0.7); backdrop-filter: blur(8px);
    }
    .crisis-overlay.active { display: flex; }
    .crisis-card {
      width: 100%; max-width: 480px; border-radius: 16px; overflow: hidden;
      background: linear-gradient(145deg, rgba(40,10,10,0.95), rgba(20,5,5,0.98));
      border: 1px solid rgba(255,59,48,0.3);
      box-shadow: 0 0 60px rgba(255,59,48,0.2);
    }
    .crisis-header {
      padding: 20px; text-align: center;
      background: linear-gradient(135deg, rgba(255,59,48,0.15), transparent);
      border-bottom: 1px solid rgba(255,59,48,0.15);
    }
    .crisis-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.15em; color: var(--red); margin-bottom: 4px; }
    .crisis-title { font-family: var(--font-heading); font-size: 1.2rem; font-weight: 700; }
    .crisis-body { padding: 20px; }
    .crisis-desc { font-size: 0.85rem; line-height: 1.6; color: rgba(255,255,255,0.6); margin-bottom: 16px; }
    .crisis-options { display: flex; flex-direction: column; gap: 10px; }
    .crisis-option {
      padding: 14px 16px; border-radius: 10px; cursor: pointer; border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.04); transition: background 0.3s, border-color 0.3s;
    }
    .crisis-option:hover { background: rgba(255,255,255,0.08); border-color: rgba(255,255,255,0.2); }
    .crisis-option-title { font-family: var(--font-heading); font-size: 0.9rem; font-weight: 600; margin-bottom: 3px; }
    .crisis-option-desc { font-size: 0.75rem; color: rgba(255,255,255,0.4); }

    /* EVENT TOAST */
    .event-toast {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px);
      background: rgba(0,24,69,0.95); backdrop-filter: blur(16px);
      border: 1px solid rgba(255,255,255,0.1); border-radius: 12px;
      padding: 14px 20px; max-width: 400px; width: calc(100% - 32px);
      z-index: 200; opacity: 0; pointer-events: none;
      box-shadow: 0 8px 40px rgba(0,0,0,0.5);
    }
    .event-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }
    .event-toast-title { font-family: var(--font-heading); font-size: 0.8rem; margin-bottom: 3px; color: var(--gold); }
    .event-toast-text { font-size: 0.78rem; line-height: 1.45; color: rgba(255,255,255,0.6); }

    /* ELECTION OVERLAY */
    .election-overlay {
      position: fixed; inset: 0; z-index: 400; display: none;
      align-items: center; justify-content: center; padding: 20px;
      background: rgba(0,0,0,0.8); backdrop-filter: blur(12px);
    }
    .election-overlay.active { display: flex; }
    .election-card {
      width: 100%; max-width: 460px; border-radius: 16px; text-align: center;
      padding: 40px 28px; background: linear-gradient(145deg, rgba(0,33,165,0.4), rgba(0,24,69,0.95));
      border: 1px solid rgba(240,168,48,0.3); box-shadow: 0 0 80px rgba(240,168,48,0.15);
    }
    .election-icon { font-size: 3rem; margin-bottom: 16px; }
    .election-title { font-family: var(--font-heading); font-size: 1.6rem; margin-bottom: 8px; }
    .election-desc { font-size: 0.9rem; color: rgba(255,255,255,0.5); line-height: 1.5; margin-bottom: 24px; }
    .election-result { font-family: var(--font-heading); font-size: 2rem; color: var(--gold); margin-bottom: 8px; }
    .election-sub { font-size: 0.8rem; color: rgba(255,255,255,0.4); margin-bottom: 24px; }

    /* GAME OVER */
    #gameover-screen { justify-content: center; min-height: 100vh; padding: 80px 20px 40px; text-align: center; }
    .go-title { font-family: var(--font-heading); font-size: clamp(1.8rem, 5vw, 2.8rem); font-weight: 700; margin-bottom: 8px; }
    .go-reason { font-size: 0.95rem; color: rgba(255,255,255,0.45); margin-bottom: 28px; max-width: 400px; line-height: 1.5; }
    .go-stats { display: flex; gap: 20px; margin-bottom: 32px; flex-wrap: wrap; justify-content: center; }
    .go-stat { text-align: center; }
    .go-stat-value { font-family: var(--font-heading); font-size: 1.8rem; font-weight: 700; color: var(--gold); }
    .go-stat-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.1em; color: rgba(255,255,255,0.35); }

    .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
    .screen { position: relative; z-index: 1; }

    @media (max-width: 600px) {
      .hud { grid-template-columns: repeat(2, 1fr); }
      .factions { grid-template-columns: repeat(2, 1fr); }
      .order-header { padding: 14px 16px 10px; }
      .order-body { padding: 14px 16px; }
      .order-actions { padding: 10px 16px 16px; }
      .hud-top { gap: 8px; }
    }
  </style>
</head>
<body>

<canvas class="particles" id="particles"></canvas>

<nav class="nav">
  <div class="nav-inner">
    <a href="../" class="nav-logo">
      <img src="../assets/images/shield-logo.png" alt="UFCR"><span>UFCR</span>
    </a>
    <a href="../games/" class="nav-back"><i class="fa-solid fa-arrow-left"></i> Games</a>
  </div>
</nav>

<!-- TITLE -->
<div id="title-screen" class="screen active">
  <div class="title-seal"><i class="fa-solid fa-stamp"></i></div>
  <h1 class="title-heading">EXECUTIVE ORDER</h1>
  <p class="title-sub">Sign or veto executive orders. Manage factions, survive crises, balance the budget. Win re-election or get removed trying.</p>
  <button class="btn-primary" onclick="startGame()">TAKE OFFICE</button>
</div>

<!-- GAME -->
<div id="game-screen" class="screen">
  <div class="hud-top">
    <div class="day-banner" id="day-banner">DAY 1</div>
    <div class="term-badge" id="term-badge">TERM 1</div>
    <div class="budget-display"><i class="fa-solid fa-landmark"></i> <span id="budget-val">100</span> Political Capital</div>
  </div>
  <div class="hud">
    <div class="hud-card" id="hud-approval">
      <div class="hud-label">Approval</div>
      <div class="hud-value" id="val-approval">60%</div>
      <div class="hud-bar"><div class="hud-bar-fill" id="bar-approval" style="width:60%;background:var(--green)"></div></div>
    </div>
    <div class="hud-card" id="hud-economy">
      <div class="hud-label">Economy</div>
      <div class="hud-value" id="val-economy">50</div>
      <div class="hud-bar"><div class="hud-bar-fill" id="bar-economy" style="width:50%;background:var(--cyan)"></div></div>
    </div>
    <div class="hud-card" id="hud-security">
      <div class="hud-label">Security</div>
      <div class="hud-value" id="val-security">50</div>
      <div class="hud-bar"><div class="hud-bar-fill" id="bar-security" style="width:50%;background:var(--orange)"></div></div>
    </div>
    <div class="hud-card" id="hud-liberty">
      <div class="hud-label">Liberty</div>
      <div class="hud-value" id="val-liberty">50</div>
      <div class="hud-bar"><div class="hud-bar-fill" id="bar-liberty" style="width:50%;background:var(--purple)"></div></div>
    </div>
  </div>
  <div class="factions" id="factions-row">
    <div class="faction" id="fac-congress">
      <div class="faction-icon">üèõÔ∏è</div>
      <div class="faction-name">Congress</div>
      <div class="faction-val" id="fac-val-congress">50</div>
      <div class="faction-bar"><div class="faction-bar-fill" id="fac-bar-congress" style="width:50%"></div></div>
    </div>
    <div class="faction" id="fac-media">
      <div class="faction-icon">üì∫</div>
      <div class="faction-name">Media</div>
      <div class="faction-val" id="fac-val-media">40</div>
      <div class="faction-bar"><div class="faction-bar-fill" id="fac-bar-media" style="width:40%"></div></div>
    </div>
    <div class="faction" id="fac-military">
      <div class="faction-icon">üéñÔ∏è</div>
      <div class="faction-name">Military</div>
      <div class="faction-val" id="fac-val-military">55</div>
      <div class="faction-bar"><div class="faction-bar-fill" id="fac-bar-military" style="width:55%"></div></div>
    </div>
    <div class="faction" id="fac-wallst">
      <div class="faction-icon">üìà</div>
      <div class="faction-name">Wall St</div>
      <div class="faction-val" id="fac-val-wallst">50</div>
      <div class="faction-bar"><div class="faction-bar-fill" id="fac-bar-wallst" style="width:50%"></div></div>
    </div>
  </div>
  <div class="order-area" id="order-area"></div>
</div>

<!-- GAME OVER -->
<div id="gameover-screen" class="screen">
  <h1 class="go-title" id="go-title">IMPEACHED</h1>
  <p class="go-reason" id="go-reason"></p>
  <div class="go-stats">
    <div class="go-stat"><div class="go-stat-value" id="go-days">0</div><div class="go-stat-label">Days</div></div>
    <div class="go-stat"><div class="go-stat-value" id="go-signed">0</div><div class="go-stat-label">Signed</div></div>
    <div class="go-stat"><div class="go-stat-value" id="go-vetoed">0</div><div class="go-stat-label">Vetoed</div></div>
    <div class="go-stat"><div class="go-stat-value" id="go-crises">0</div><div class="go-stat-label">Crises</div></div>
    <div class="go-stat"><div class="go-stat-value" id="go-term">1</div><div class="go-stat-label">Term</div></div>
  </div>
  <button class="btn-primary" onclick="startGame()">RUN AGAIN</button>
</div>

<div class="event-toast" id="event-toast">
  <div class="event-toast-title" id="toast-title"></div>
  <div class="event-toast-text" id="toast-text"></div>
</div>

<!-- CRISIS OVERLAY -->
<div class="crisis-overlay" id="crisis-overlay">
  <div class="crisis-card">
    <div class="crisis-header">
      <div class="crisis-label">‚ö†Ô∏è CONSTITUTIONAL CRISIS</div>
      <div class="crisis-title" id="crisis-title"></div>
    </div>
    <div class="crisis-body">
      <div class="crisis-desc" id="crisis-desc"></div>
      <div class="crisis-options" id="crisis-options"></div>
    </div>
  </div>
</div>

<!-- ELECTION OVERLAY -->
<div class="election-overlay" id="election-overlay">
  <div class="election-card" id="election-card"></div>
</div>

<script>
// ==================== ADVISORS ====================
const ADVISORS = [
  { name: "Gen. Hayes", role: "SecDef", color: "#F0A830", bg: "rgba(240,168,48,0.15)", bias: "security",
    pro: ["This strengthens our position.", "The military stands behind this.", "National security demands it."],
    con: ["This weakens our defenses.", "Our adversaries will exploit this.", "The Pentagon strongly advises against it."] },
  { name: "Dr. Chen", role: "Econ Advisor", color: "#32D4DE", bg: "rgba(50,212,222,0.15)", bias: "economy",
    pro: ["Markets will love this.", "Good for growth and jobs.", "The numbers support this."],
    con: ["This will tank the markets.", "Economically reckless.", "Wall Street will panic."] },
  { name: "Sen. Blake", role: "Congressional Liaison", color: "#AF52DE", bg: "rgba(175,82,222,0.15)", bias: "approval",
    pro: ["You'll have bipartisan support on this.", "The polls favor it.", "Smart move politically."],
    con: ["You'll lose the moderates.", "Politically toxic.", "Congress will push back hard."] },
  { name: "Ms. Torres", role: "Civil Liberties Counsel", color: "#FF6B6B", bg: "rgba(255,107,107,0.15)", bias: "liberty",
    pro: ["A win for individual rights.", "The Constitution supports this.", "Freedom-lovers will rally behind you."],
    con: ["This sets a dangerous precedent.", "Civil liberties groups will sue.", "This is overreach, Mr. President."] },
];

function getAdvisorQuotes(order) {
  // Pick 2-3 advisors with conflicting views
  const picks = [];
  const shuffled = [...ADVISORS].sort(() => Math.random() - 0.5);
  for (const adv of shuffled) {
    if (picks.length >= 3) break;
    const signVal = order.sign[adv.bias] || 0;
    const vetoVal = order.veto[adv.bias] || 0;
    const netSign = signVal;
    const favorsSign = netSign > 0;
    const quote = favorsSign
      ? adv.pro[Math.floor(Math.random() * adv.pro.length)]
      : adv.con[Math.floor(Math.random() * adv.con.length)];
    picks.push({ ...adv, quote, favorsSign });
  }
  return picks;
}

// ==================== ORDERS ====================
const ORDERS = [
  // IMMIGRATION
  { cat: "Immigration", icon: "fa-passport", color: "#FA4616", cost: 8,
    title: "Close the Southern Border", desc: "Deploy the National Guard to enforce a complete halt on illegal border crossings.",
    sign: { approval: 8, economy: -5, security: 15, liberty: -8 }, signFac: { congress: -5, media: -10, military: 10, wallst: -3 },
    veto: { approval: -6, economy: 3, security: -10, liberty: 5 }, vetoFac: { congress: 3, media: 8, military: -5, wallst: 2 },
    signEvent: "Border crossings drop 94%. CNN loses its mind.", vetoEvent: "Open borders activists celebrate. Crossings surge.",
    chain: { delay: 3, title: "Border Humanitarian Crisis", text: "Overcrowded detention facilities spark international outrage.", effect: { approval: -6, liberty: -4 }, facEffect: { media: -8 } } },
  { cat: "Immigration", icon: "fa-helicopter", color: "#FA4616", cost: 10,
    title: "Activate ICE Deportation Force", desc: "Massively expand ICE operations to remove criminal illegal aliens from American cities.",
    sign: { approval: 10, economy: -3, security: 12, liberty: -6 }, signFac: { congress: -4, media: -12, military: 8, wallst: -2 },
    veto: { approval: -8, economy: 2, security: -8, liberty: 4 }, vetoFac: { congress: 2, media: 6, military: -4, wallst: 1 },
    signEvent: "ICE conducts record operations. Sanctuary cities furious.", vetoEvent: "Criminal aliens remain. Crime ticks up." },
  { cat: "Immigration", icon: "fa-person-walking-dashed-line-arrow-right", color: "#FA4616", cost: 12,
    title: "Fund the Border Wall", desc: "Redirect $12 billion in military funds to complete the entire southern border wall.",
    sign: { approval: 6, economy: -8, security: 10, liberty: -2 }, signFac: { congress: -8, media: -6, military: -3, wallst: -4 },
    veto: { approval: -4, economy: 5, security: -6, liberty: 2 }, vetoFac: { congress: 4, media: 4, military: 2, wallst: 3 },
    signEvent: "Construction begins. Thousands of workers hired.", vetoEvent: "Wall remains incomplete. Cartels celebrate." },

  // ECONOMY
  { cat: "Economy", icon: "fa-chart-line", color: "#32D4DE", cost: 6,
    title: "Slash Corporate Tax to 15%", desc: "Cut the corporate tax rate to supercharge business investment.",
    sign: { approval: 5, economy: 14, security: 0, liberty: 5 }, signFac: { congress: -3, media: -5, military: 0, wallst: 15 },
    veto: { approval: -3, economy: -8, security: 0, liberty: -2 }, vetoFac: { congress: 2, media: 3, military: 0, wallst: -12 },
    signEvent: "Markets surge 800 points. Companies announce new factories.", vetoEvent: "Wall Street disappointed. Companies eye overseas." },
  { cat: "Economy", icon: "fa-gas-pump", color: "#32D4DE", cost: 5,
    title: "Drill Baby Drill", desc: "Open all federal lands for energy exploration. Kill the red tape.",
    sign: { approval: 7, economy: 12, security: 3, liberty: 4 }, signFac: { congress: 3, media: -8, military: 2, wallst: 10 },
    veto: { approval: -5, economy: -6, security: -2, liberty: -1 }, vetoFac: { congress: -2, media: 6, military: -1, wallst: -6 },
    signEvent: "Gas prices plummet. Energy independence achieved.", vetoEvent: "Gas hits $6/gallon. OPEC celebrates.",
    chain: { delay: 4, title: "Gulf Oil Spill", text: "Massive spill off the Louisiana coast. Environmental disaster.", effect: { approval: -8, economy: -5 }, facEffect: { media: -10, wallst: -5 } } },
  { cat: "Economy", icon: "fa-coins", color: "#32D4DE", cost: 4,
    title: "No Tax on Tips", desc: "Direct Treasury to stop collecting income tax on tipped wages.",
    sign: { approval: 12, economy: -4, security: 0, liberty: 8 }, signFac: { congress: -2, media: 2, military: 0, wallst: -3 },
    veto: { approval: -10, economy: 3, security: 0, liberty: -3 }, vetoFac: { congress: 1, media: -1, military: 0, wallst: 2 },
    signEvent: "Service workers ecstatic. Restaurant industry booms.", vetoEvent: "Waiters and bartenders disappointed across America." },
  { cat: "Economy", icon: "fa-sack-dollar", color: "#32D4DE", cost: 7,
    title: "25% Tariff on China", desc: "Slap a massive tariff on all Chinese imports to protect American manufacturing.",
    sign: { approval: 4, economy: -6, security: 8, liberty: -3 }, signFac: { congress: 4, media: -3, military: 6, wallst: -10 },
    veto: { approval: -3, economy: 8, security: -4, liberty: 3 }, vetoFac: { congress: -3, media: 2, military: -3, wallst: 8 },
    signEvent: "Trade war escalates. American steel rejoices.", vetoEvent: "Cheap Chinese goods keep flooding in.",
    chain: { delay: 3, title: "China Retaliates", text: "Beijing slaps 40% tariffs on American agriculture. Farmers hit hard.", effect: { approval: -5, economy: -8 }, facEffect: { congress: -5, wallst: -6 } } },
  { cat: "Economy", icon: "fa-bitcoin-sign", color: "#32D4DE", cost: 8,
    title: "National Bitcoin Reserve", desc: "Order Treasury to purchase 1 million Bitcoin as a strategic reserve asset.",
    sign: { approval: 4, economy: -5, security: 2, liberty: 10 }, signFac: { congress: -8, media: -4, military: -2, wallst: 8 },
    veto: { approval: -2, economy: 3, security: 0, liberty: -4 }, vetoFac: { congress: 3, media: 2, military: 1, wallst: -3 },
    signEvent: "Bitcoin moons. Crypto bros worship you.", vetoEvent: "Crypto community calls you a boomer." },

  // SECURITY
  { cat: "Security", icon: "fa-shield-halved", color: "#F0A830", cost: 12,
    title: "Rebuild the Military", desc: "Increase defense spending by $100 billion. New ships, jets, cyber capabilities.",
    sign: { approval: 5, economy: -10, security: 15, liberty: -3 }, signFac: { congress: -6, media: -4, military: 18, wallst: 5 },
    veto: { approval: -4, economy: 6, security: -12, liberty: 2 }, vetoFac: { congress: 3, media: 3, military: -15, wallst: -2 },
    signEvent: "Pentagon cheers. New aircraft carriers commissioned.", vetoEvent: "Military readiness concerns grow." },
  { cat: "Security", icon: "fa-gun", color: "#F0A830", cost: 5,
    title: "National Concealed Carry", desc: "All states must recognize concealed carry permits from every other state.",
    sign: { approval: 6, economy: 0, security: 5, liberty: 14 }, signFac: { congress: -5, media: -10, military: 4, wallst: 0 },
    veto: { approval: -5, economy: 0, security: -2, liberty: -10 }, vetoFac: { congress: 3, media: 6, military: -2, wallst: 0 },
    signEvent: "2A supporters celebrate. NRA membership surges.", vetoEvent: "Gun rights groups vow primary challenges." },
  { cat: "Security", icon: "fa-user-secret", color: "#F0A830", cost: 6,
    title: "Ban TikTok", desc: "Complete ban on TikTok and all ByteDance products in the United States.",
    sign: { approval: -5, economy: 2, security: 12, liberty: -10 }, signFac: { congress: 5, media: 3, military: 8, wallst: 3 },
    veto: { approval: 4, economy: -1, security: -8, liberty: 6 }, vetoFac: { congress: -3, media: -2, military: -4, wallst: -1 },
    signEvent: "Gen Z riots. National security experts approve.", vetoEvent: "CCP data collection continues.",
    chain: { delay: 2, title: "Gen Z Backlash", text: "Massive protests outside the White House. Youth voter registration spikes against you.", effect: { approval: -10 }, facEffect: { media: -6, congress: -4 } } },
  { cat: "Security", icon: "fa-satellite", color: "#F0A830", cost: 14,
    title: "Expand Space Force", desc: "Triple Space Force budget. Establish a permanent lunar military presence.",
    sign: { approval: 3, economy: -8, security: 10, liberty: 0 }, signFac: { congress: -4, media: 2, military: 12, wallst: 4 },
    veto: { approval: -1, economy: 5, security: -5, liberty: 0 }, vetoFac: { congress: 2, media: -1, military: -8, wallst: -2 },
    signEvent: "Moon base construction begins. Elon approves.", vetoEvent: "China beats us to the moon." },

  // LIBERTY
  { cat: "Liberty", icon: "fa-graduation-cap", color: "#AF52DE", cost: 4,
    title: "Ban DEI in Federal Agencies", desc: "Eliminate all Diversity, Equity, and Inclusion programs from the federal government.",
    sign: { approval: 8, economy: 4, security: 0, liberty: 6 }, signFac: { congress: -3, media: -14, military: 3, wallst: 4 },
    veto: { approval: -6, economy: -2, security: 0, liberty: -4 }, vetoFac: { congress: 2, media: 10, military: -2, wallst: -1 },
    signEvent: "DEI bureaucrats pack their desks. Meritocracy restored.", vetoEvent: "Mandatory diversity trainings continue." },
  { cat: "Liberty", icon: "fa-book", color: "#AF52DE", cost: 6,
    title: "School Choice", desc: "Federal education funding follows the student. Parents choose any school.",
    sign: { approval: 7, economy: -3, security: 0, liberty: 12 }, signFac: { congress: -6, media: -5, military: 0, wallst: 3 },
    veto: { approval: -5, economy: 2, security: 0, liberty: -8 }, vetoFac: { congress: 4, media: 4, military: 0, wallst: -1 },
    signEvent: "Parents rejoice. Teachers unions declare war.", vetoEvent: "Public school monopoly preserved." },
  { cat: "Liberty", icon: "fa-cross", color: "#AF52DE", cost: 3,
    title: "Protect Religious Liberty", desc: "Sweeping order preventing government from penalizing faith-based organizations.",
    sign: { approval: 6, economy: 0, security: 0, liberty: 10 }, signFac: { congress: 2, media: -8, military: 2, wallst: 0 },
    veto: { approval: -4, economy: 0, security: 0, liberty: -6 }, vetoFac: { congress: -1, media: 5, military: -1, wallst: 0 },
    signEvent: "Churches celebrate. ACLU files 47 lawsuits.", vetoEvent: "Faith organizations feel abandoned." },
  { cat: "Liberty", icon: "fa-tower-broadcast", color: "#AF52DE", cost: 10,
    title: "Break Up Big Tech", desc: "Direct DOJ to pursue antitrust action against Google, Meta, and Amazon.",
    sign: { approval: 9, economy: -7, security: 2, liberty: 10 }, signFac: { congress: 5, media: 4, military: 0, wallst: -14 },
    veto: { approval: -6, economy: 5, security: -2, liberty: -8 }, vetoFac: { congress: -3, media: -3, military: 0, wallst: 10 },
    signEvent: "Silicon Valley panics. Free speech advocates celebrate.", vetoEvent: "Tech monopolies tighten their grip." },
  { cat: "Liberty", icon: "fa-cannabis", color: "#AF52DE", cost: 5,
    title: "Legalize Cannabis", desc: "Deschedule marijuana entirely. Pardon all federal cannabis offenses.",
    sign: { approval: 10, economy: 8, security: -4, liberty: 12 }, signFac: { congress: -4, media: 8, military: -3, wallst: 6 },
    veto: { approval: -6, economy: -3, security: 3, liberty: -8 }, vetoFac: { congress: 2, media: -4, military: 2, wallst: -2 },
    signEvent: "Snoop Dogg tweets your approval to the moon.", vetoEvent: "Prohibition continues. Black market thrives." },

  // CLASSIFIED / WILD
  { cat: "Classified", icon: "fa-file-shield", color: "#FF6B6B", cost: 7,
    title: "Release the JFK Files", desc: "Declassify every document related to the JFK assassination. No redactions.",
    sign: { approval: 14, economy: 0, security: -8, liberty: 12 }, signFac: { congress: -4, media: 10, military: -12, wallst: 0 },
    veto: { approval: -10, economy: 0, security: 5, liberty: -10 }, vetoFac: { congress: 2, media: -6, military: 8, wallst: 0 },
    signEvent: "Conspiracy theorists vindicated. CIA director resigns.", vetoEvent: "The truth stays buried." },
  { cat: "Classified", icon: "fa-user-astronaut", color: "#FF6B6B", cost: 6,
    title: "Disclose UFO Programs", desc: "Full disclosure of all UAP/UFO programs including recovered materials.",
    sign: { approval: 8, economy: 2, security: -12, liberty: 15 }, signFac: { congress: 3, media: 12, military: -15, wallst: 2 },
    veto: { approval: -4, economy: 0, security: 8, liberty: -6 }, vetoFac: { congress: -1, media: -5, military: 10, wallst: 0 },
    signEvent: "Pentagon admits alien tech. World freaks out.", vetoEvent: "Cover-up continues. Whistleblowers silenced.",
    chain: { delay: 2, title: "Global Panic", text: "World leaders demand answers. Stock markets crash as existential questions grip humanity.", effect: { approval: -5, economy: -10, security: -5 }, facEffect: { media: 8, wallst: -12, military: -8 } } },
  { cat: "Executive Power", icon: "fa-gavel", color: "#FFD060", cost: 8,
    title: "Abolish the ATF", desc: "Dismantle the Bureau of Alcohol, Tobacco, Firearms and Explosives entirely.",
    sign: { approval: 5, economy: 3, security: -8, liberty: 15 }, signFac: { congress: -8, media: -6, military: -2, wallst: 2 },
    veto: { approval: -3, economy: -1, security: 5, liberty: -10 }, vetoFac: { congress: 4, media: 3, military: 2, wallst: 0 },
    signEvent: "Gun owners celebrate. ATF agents update resumes.", vetoEvent: "ATF announces expanded operations." },
  { cat: "Executive Power", icon: "fa-landmark", color: "#FFD060", cost: 15,
    title: "Term Limits for Congress", desc: "Demand a constitutional convention for congressional term limits.",
    sign: { approval: 15, economy: 0, security: 0, liberty: 8 }, signFac: { congress: -20, media: 6, military: 0, wallst: -2 },
    veto: { approval: -12, economy: 0, security: 0, liberty: -5 }, vetoFac: { congress: 10, media: -4, military: 0, wallst: 2 },
    signEvent: "Career politicians panic. The people cheer.", vetoEvent: "Swamp creatures breathe a sigh of relief.",
    chain: { delay: 2, title: "Congress Strikes Back", text: "Furious Congress members launch investigations into your administration.", effect: { approval: -8, liberty: -4 }, facEffect: { congress: -10 } } },
  { cat: "Executive Power", icon: "fa-money-bill-transfer", color: "#FFD060", cost: 9,
    title: "Audit the Federal Reserve", desc: "Order a complete public audit of the Fed's balance sheet and transactions.",
    sign: { approval: 10, economy: -8, security: 0, liberty: 10 }, signFac: { congress: -6, media: 4, military: 0, wallst: -15 },
    veto: { approval: -7, economy: 5, security: 0, liberty: -6 }, vetoFac: { congress: 3, media: -2, military: 0, wallst: 10 },
    signEvent: "Markets wobble. Transparency advocates ecstatic.", vetoEvent: "The Fed continues in the shadows." },
  { cat: "Foreign Policy", icon: "fa-flag-usa", color: "#4A90D9", cost: 10,
    title: "Withdraw from the UN", desc: "Pull the US out of the United Nations. Stop all funding immediately.",
    sign: { approval: 4, economy: 8, security: -6, liberty: 6 }, signFac: { congress: -6, media: -10, military: 4, wallst: 3 },
    veto: { approval: -2, economy: -4, security: 4, liberty: -2 }, vetoFac: { congress: 3, media: 5, military: -2, wallst: -1 },
    signEvent: "Globalists in shambles. Full sovereignty.", vetoEvent: "UN peacekeeping continues with your tax dollars." },
  { cat: "Foreign Policy", icon: "fa-handshake-slash", color: "#4A90D9", cost: 6,
    title: "End All Foreign Aid", desc: "Halt all foreign aid. Redirect to domestic infrastructure.",
    sign: { approval: 7, economy: 12, security: -5, liberty: 2 }, signFac: { congress: 2, media: -8, military: -3, wallst: 5 },
    veto: { approval: -4, economy: -6, security: 3, liberty: 0 }, vetoFac: { congress: -1, media: 4, military: 2, wallst: -2 },
    signEvent: "Billions saved. Roads and bridges get funded.", vetoEvent: "Billions flow overseas while potholes multiply." },
  { cat: "Economy", icon: "fa-percent", color: "#32D4DE", cost: 3,
    title: "Freeze Federal Hiring", desc: "Impose an immediate freeze on all non-essential federal hiring.",
    sign: { approval: 6, economy: 6, security: -2, liberty: 3 }, signFac: { congress: 2, media: -3, military: -2, wallst: 6 },
    veto: { approval: -3, economy: -3, security: 1, liberty: -1 }, vetoFac: { congress: -1, media: 2, military: 1, wallst: -3 },
    signEvent: "Government bloat reduced. Efficiency up.", vetoEvent: "Federal workforce continues growing." },
  { cat: "Security", icon: "fa-mask", color: "#F0A830", cost: 7,
    title: "Pardon January 6 Defendants", desc: "Issue a blanket pardon for all January 6 defendants.",
    sign: { approval: 6, economy: 0, security: -5, liberty: 8 }, signFac: { congress: -10, media: -15, military: -4, wallst: 0 },
    veto: { approval: -8, economy: 0, security: 3, liberty: -4 }, vetoFac: { congress: 5, media: 10, military: 2, wallst: 0 },
    signEvent: "Base goes wild. Media melts down completely.", vetoEvent: "Your base feels betrayed." },
];

// ==================== CRISES ====================
const CRISES = [
  { title: "Supreme Court Blocks Your Order",
    desc: "The Supreme Court rules your latest executive order unconstitutional. Do you comply or defy?",
    options: [
      { title: "Comply with the ruling", desc: "Respect the Court's authority. Your base won't like it.",
        effect: { approval: -8, liberty: 6 }, facEffect: { congress: 8, media: 6, military: 2 } },
      { title: "Defy the Court", desc: "Ignore the ruling. Assert executive supremacy.",
        effect: { approval: 5, liberty: -15, security: 5 }, facEffect: { congress: -15, media: -12, military: -5 } },
    ]},
  { title: "Assassination Attempt",
    desc: "A lone gunman opens fire at your rally. You survive, but the nation is shaken. How do you respond?",
    options: [
      { title: "Call for unity", desc: "Use the moment to unite the country across party lines.",
        effect: { approval: 15, security: -3, liberty: 3 }, facEffect: { congress: 8, media: 10, military: 5 } },
      { title: "Crack down on threats", desc: "Expand Secret Service powers and domestic surveillance.",
        effect: { approval: 5, security: 15, liberty: -12 }, facEffect: { congress: -4, media: -8, military: 10 } },
    ]},
  { title: "Government Shutdown Showdown",
    desc: "Congress refuses to pass a budget. The government is shutting down in 24 hours.",
    options: [
      { title: "Negotiate with Congress", desc: "Give up some political capital to keep things running.",
        effect: { approval: 3, economy: 2 }, facEffect: { congress: 10, media: 4 }, capitalCost: 15 },
      { title: "Let it shut down", desc: "Hold your ground. Blame Congress for the mess.",
        effect: { approval: -6, economy: -8 }, facEffect: { congress: -10, media: -5, wallst: -8 } },
    ]},
  { title: "Military Coup Rumors",
    desc: "Intelligence reports suggest top generals are discussing your removal. Pentagon denies everything.",
    options: [
      { title: "Fire the generals", desc: "Clean house at the Pentagon. Assert civilian control.",
        effect: { approval: 3, security: -10, liberty: -5 }, facEffect: { military: -20, congress: -5 } },
      { title: "Meet them privately", desc: "Negotiate behind closed doors. Show strength through diplomacy.",
        effect: { approval: -2, security: 3 }, facEffect: { military: 8, congress: 2 } },
    ]},
  { title: "Pandemic Outbreak",
    desc: "A new virus emerges. Millions are looking to you for leadership. The pressure is immense.",
    options: [
      { title: "Full lockdown", desc: "Shut everything down. Flatten the curve at all costs.",
        effect: { approval: 3, economy: -15, security: 5, liberty: -12 }, facEffect: { media: 8, wallst: -12, congress: -3 } },
      { title: "Keep it open", desc: "Protect the economy. Let states decide their own response.",
        effect: { approval: -3, economy: 5, security: -5, liberty: 10 }, facEffect: { media: -10, wallst: 8, congress: 3 } },
    ]},
  { title: "Foreign Nuclear Threat",
    desc: "North Korea launches an ICBM toward the Pacific. It splashes 200 miles from Hawaii.",
    options: [
      { title: "Military strike", desc: "Respond with overwhelming force. Destroy their launch sites.",
        effect: { approval: 8, economy: -10, security: 12, liberty: -5 }, facEffect: { military: 15, media: -5, wallst: -10, congress: 5 } },
      { title: "Diplomatic response", desc: "Go to the UN. Pursue sanctions and de-escalation.",
        effect: { approval: -5, economy: -2, security: -8, liberty: 5 }, facEffect: { military: -10, media: 8, wallst: 3, congress: 3 } },
    ]},
  { title: "Whistleblower Bombshell",
    desc: "A former cabinet member leaks documents showing your team cut corners on a major policy. It's all over the news.",
    options: [
      { title: "Full transparency", desc: "Release everything. Take the hit and move on.",
        effect: { approval: -5, liberty: 8 }, facEffect: { media: 10, congress: 5 } },
      { title: "Discredit the leaker", desc: "Attack their credibility. Control the narrative.",
        effect: { approval: 3, liberty: -8 }, facEffect: { media: -10, congress: -3 } },
    ]},
  { title: "Impeachment Proceedings Begin",
    desc: "The House has enough votes to begin formal impeachment hearings. This is real.",
    options: [
      { title: "Fight it publicly", desc: "Go on every network. Rally your base. Make them pay.",
        effect: { approval: 5, security: -3 }, facEffect: { congress: -12, media: -5 }, capitalCost: 12 },
      { title: "Cooperate with the process", desc: "Provide documents and testimony. Let truth be your defense.",
        effect: { approval: -8, liberty: 5 }, facEffect: { congress: 8, media: 6 } },
    ]},
];

// ==================== FACTION SABOTAGE ====================
const SABOTAGE = {
  congress: [
    { title: "Congress Blocks Your Agenda", text: "Congressional leaders refuse to bring any of your priorities to a vote.", effect: { approval: -4 } },
    { title: "Subpoena Flood", text: "Congress launches 6 simultaneous investigations into your administration.", effect: { approval: -6, liberty: -3 } },
  ],
  media: [
    { title: "Media Hit Piece", text: "A coordinated media blitz runs negative coverage 24/7 for a week.", effect: { approval: -8 } },
    { title: "Leaked Audio", text: "Media publishes out-of-context audio from a private meeting.", effect: { approval: -10 } },
  ],
  military: [
    { title: "Military Brass Revolt", text: "Joint Chiefs publicly disagree with your security strategy.", effect: { security: -8, approval: -4 } },
    { title: "Failed Operation", text: "A military operation goes wrong. Pentagon blames lack of resources.", effect: { security: -10, approval: -6 } },
  ],
  wallst: [
    { title: "Market Selloff", text: "Wall Street stages a coordinated selloff to pressure your policies.", effect: { economy: -10, approval: -4 } },
    { title: "Credit Downgrade", text: "Rating agencies downgrade US debt citing policy uncertainty.", effect: { economy: -12, approval: -5 } },
  ],
};

// ==================== STATE ====================
let state = {};
let toastTimeout = null;

function initState() {
  return {
    approval: 60, economy: 50, security: 50, liberty: 50,
    factions: { congress: 50, media: 40, military: 55, wallst: 50 },
    budget: 100, day: 1, term: 1, signed: 0, vetoed: 0, crisesHandled: 0,
    orderQueue: [], pendingChains: [], playing: false,
    electionDay: 100, term2Bonus: false, decayRate: 0,
    sabotageCD: { congress: 0, media: 0, military: 0, wallst: 0 },
  };
}

// ==================== PARTICLES ====================
const pCanvas = document.getElementById('particles');
const pCtx = pCanvas.getContext('2d');
let dots = [];
function resizeCanvas() { pCanvas.width = window.innerWidth; pCanvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();
for (let i = 0; i < 40; i++) {
  dots.push({ x: Math.random()*pCanvas.width, y: Math.random()*pCanvas.height,
    vx: (Math.random()-0.5)*0.25, vy: (Math.random()-0.5)*0.25,
    r: Math.random()*1.5+0.5, a: Math.random()*0.12+0.02 });
}
function drawParticles() {
  pCtx.clearRect(0,0,pCanvas.width,pCanvas.height);
  dots.forEach(d => {
    d.x += d.vx; d.y += d.vy;
    if (d.x < 0 || d.x > pCanvas.width) d.vx *= -1;
    if (d.y < 0 || d.y > pCanvas.height) d.vy *= -1;
    pCtx.beginPath(); pCtx.arc(d.x,d.y,d.r,0,Math.PI*2);
    pCtx.fillStyle = `rgba(240,168,48,${d.a})`; pCtx.fill();
  });
  requestAnimationFrame(drawParticles);
}
drawParticles();

// ==================== SCREENS ====================
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ==================== HUD UPDATE ====================
function clamp(v) { return Math.max(0, Math.min(100, Math.round(v))); }

function updateHUD(animate) {
  const stats = ['approval','economy','security','liberty'];
  const barColors = { approval:'var(--green)', economy:'var(--cyan)', security:'var(--orange)', liberty:'var(--purple)' };
  stats.forEach(s => {
    state[s] = clamp(state[s]);
    const el = document.getElementById(`val-${s}`);
    const bar = document.getElementById(`bar-${s}`);
    const card = document.getElementById(`hud-${s}`);
    if (animate && el._prev !== undefined && el._prev !== state[s]) {
      const cls = state[s] > el._prev ? 'pulse-up' : 'pulse-down';
      card.classList.add(cls);
      setTimeout(() => card.classList.remove(cls), 700);
    }
    el.textContent = s === 'approval' ? state[s] + '%' : state[s];
    bar.style.width = state[s] + '%';
    bar.style.background = state[s] < 20 ? 'var(--red)' : barColors[s];
    el._prev = state[s];
  });

  // Factions
  ['congress','media','military','wallst'].forEach(f => {
    state.factions[f] = clamp(state.factions[f]);
    const el = document.getElementById(`fac-val-${f}`);
    const bar = document.getElementById(`fac-bar-${f}`);
    const card = document.getElementById(`fac-${f}`);
    el.textContent = state.factions[f];
    bar.style.width = state.factions[f] + '%';
    bar.style.background = state.factions[f] < 20 ? 'var(--red)' : state.factions[f] > 70 ? 'var(--green)' : 'var(--gold)';
    card.classList.remove('hostile','friendly');
    if (state.factions[f] < 25) card.classList.add('hostile');
    else if (state.factions[f] > 70) card.classList.add('friendly');
  });

  document.getElementById('day-banner').textContent = `DAY ${state.day}`;
  document.getElementById('term-badge').textContent = state.term === 1 ? 'TERM 1' : 'TERM 2';
  document.getElementById('budget-val').textContent = state.budget;
}

// ==================== TOAST ====================
function showToast(title, text, duration) {
  if (toastTimeout) clearTimeout(toastTimeout);
  const toast = document.getElementById('event-toast');
  document.getElementById('toast-title').textContent = title;
  document.getElementById('toast-text').textContent = text;
  gsap.fromTo(toast, { y: 80, opacity: 0 }, { y: 0, opacity: 1, duration: 0.35, ease: 'power3.out' });
  toast.classList.add('show');
  toastTimeout = setTimeout(() => {
    gsap.to(toast, { y: 80, opacity: 0, duration: 0.25, onComplete: () => toast.classList.remove('show') });
  }, duration || 2200);
}

// ==================== ORDER RENDERING ====================
function shuffleOrders() {
  const arr = [...ORDERS];
  for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; }
  return arr;
}

function showOrder() {
  if (!state.playing) return;
  if (state.orderQueue.length === 0) state.orderQueue = shuffleOrders();
  const order = state.orderQueue.pop();
  state.currentOrder = order;

  const advisors = getAdvisorQuotes(order);
  const canAfford = state.budget >= order.cost;

  const effectsHTML = Object.entries(order.sign).filter(([k,v]) => v !== 0).map(([k,v]) => {
    const cls = v > 0 ? 'positive' : 'negative';
    const arrow = v > 0 ? '‚Üë' : '‚Üì';
    return `<span class="order-effect ${cls}">${arrow} ${k.charAt(0).toUpperCase()+k.slice(1)} ${v>0?'+':''}${v}</span>`;
  }).join('');

  const advisorHTML = advisors.map(a => `
    <div class="advisor-quote" style="border-color:${a.color}">
      <div class="advisor-avatar" style="background:${a.bg};color:${a.color}">${a.name.charAt(0)}</div>
      <div>
        <div class="advisor-name" style="color:${a.color}">${a.name} <span style="color:rgba(255,255,255,0.3);font-weight:400">${a.role}</span></div>
        <div class="advisor-text">"${a.quote}"</div>
      </div>
    </div>
  `).join('');

  const area = document.getElementById('order-area');
  area.innerHTML = `
    <div class="order-card" id="current-card">
      <div class="order-header">
        <div class="order-icon" style="background:${order.color}18;color:${order.color}">
          <i class="fa-solid ${order.icon}"></i>
        </div>
        <div>
          <div class="order-category">${order.cat}</div>
          <div class="order-title">${order.title}</div>
        </div>
      </div>
      <div class="order-body">
        <div class="order-desc">${order.desc}</div>
        <div class="order-cost"><i class="fa-solid fa-landmark"></i> Costs ${order.cost} Political Capital</div>
        <div class="order-effects">${effectsHTML}</div>
        <div class="advisor-section">
          <div class="advisor-section-title">Advisors</div>
          <div class="advisor-quotes">${advisorHTML}</div>
        </div>
      </div>
      <div class="order-actions">
        <button class="btn-sign" onclick="decide('sign')" ${!canAfford ? 'disabled title="Not enough capital"' : ''}>
          <i class="fa-solid fa-signature"></i> SIGN${!canAfford ? ' (need '+order.cost+')' : ''}
        </button>
        <button class="btn-veto" onclick="decide('veto')"><i class="fa-solid fa-ban"></i> VETO</button>
      </div>
    </div>
  `;

  const card = document.getElementById('current-card');
  gsap.fromTo(card, { opacity: 0, y: 30, scale: 0.97 }, { opacity: 1, y: 0, scale: 1, duration: 0.45, ease: 'power3.out' });
}

// ==================== DECISIONS ====================
function decide(action) {
  const order = state.currentOrder;
  const effects = action === 'sign' ? order.sign : order.veto;
  const facEffects = action === 'sign' ? order.signFac : order.vetoFac;
  const eventText = action === 'sign' ? order.signEvent : order.vetoEvent;

  if (action === 'sign') {
    state.budget -= order.cost;
    state.signed++;
    // Chain reaction
    if (order.chain) {
      state.pendingChains.push({ ...order.chain, triggerDay: state.day + order.chain.delay });
    }
  } else {
    state.vetoed++;
  }

  // Apply stat effects
  Object.entries(effects).forEach(([k,v]) => { state[k] += v; });
  // Apply faction effects
  if (facEffects) Object.entries(facEffects).forEach(([k,v]) => { state.factions[k] += v; });

  // Animate card out
  const card = document.getElementById('current-card');
  const dir = action === 'sign' ? 1 : -1;
  gsap.to(card, {
    x: dir * 350, opacity: 0, rotation: dir * 12, duration: 0.35, ease: 'power2.in',
    onComplete: () => advanceDay(eventText)
  });
}

// ==================== DAY ADVANCEMENT ====================
function advanceDay(eventText) {
  updateHUD(true);
  showToast(state.currentOrder ? (eventText.includes('!') ? 'üì∞ BREAKING' : 'üìã RESULT') : 'üì∞ NEWS', eventText);

  setTimeout(() => {
    if (checkGameOver()) return;

    // Check chains
    const triggered = state.pendingChains.filter(c => state.day >= c.triggerDay);
    state.pendingChains = state.pendingChains.filter(c => state.day < c.triggerDay);

    if (triggered.length > 0) {
      processChains(triggered, 0, () => afterChains());
    } else {
      afterChains();
    }
  }, 1000);
}

function processChains(chains, idx, cb) {
  if (idx >= chains.length) return cb();
  const c = chains[idx];
  Object.entries(c.effect).forEach(([k,v]) => { state[k] += v; });
  if (c.facEffect) Object.entries(c.facEffect).forEach(([k,v]) => { state.factions[k] += v; });
  updateHUD(true);
  showToast('‚ö° CHAIN REACTION: ' + c.title, c.text, 2800);
  setTimeout(() => {
    if (checkGameOver()) return;
    processChains(chains, idx + 1, cb);
  }, 2000);
}

function afterChains() {
  // Faction sabotage check
  let sabotaged = false;
  for (const [fac, loyalty] of Object.entries(state.factions)) {
    if (loyalty < 20 && state.sabotageCD[fac] <= 0 && Math.random() < 0.4) {
      const sabs = SABOTAGE[fac];
      const s = sabs[Math.floor(Math.random() * sabs.length)];
      Object.entries(s.effect).forEach(([k,v]) => { state[k] += v; });
      updateHUD(true);
      state.sabotageCD[fac] = 5; // cooldown
      showToast(`üî• ${fac.toUpperCase()} SABOTAGE`, s.text, 2500);
      sabotaged = true;
      break; // one sabotage per turn
    }
  }
  Object.keys(state.sabotageCD).forEach(k => { if (state.sabotageCD[k] > 0) state.sabotageCD[k]--; });

  const delay = sabotaged ? 2000 : 200;
  setTimeout(() => {
    if (checkGameOver()) return;

    // Crisis check (every 8-12 days, random)
    if (state.day > 5 && state.day % (7 + Math.floor(Math.random()*5)) === 0 && Math.random() < 0.6) {
      triggerCrisis();
      return;
    }

    // Election check
    if (state.day === state.electionDay && state.term === 1) {
      triggerElection();
      return;
    }

    proceedToNextDay();
  }, delay);
}

function proceedToNextDay() {
  state.day++;

  // Difficulty ramp: stat decay
  state.decayRate = Math.min(2.5, 0.2 + (state.day * 0.015));
  // Decay a random stat each day (weighted toward whichever is highest)
  const stats = ['approval','economy','security','liberty'];
  const weights = stats.map(s => state[s]);
  const total = weights.reduce((a,b) => a+b, 0);
  let r = Math.random() * total;
  for (let i = 0; i < stats.length; i++) {
    r -= weights[i];
    if (r <= 0) { state[stats[i]] -= state.decayRate; break; }
  }

  // Approval always decays slightly
  state.approval -= 0.3;

  // Budget regeneration (slower over time)
  const regen = Math.max(2, 6 - Math.floor(state.day / 20));
  state.budget = Math.min(150, state.budget + regen);

  // Term 2 is harder
  if (state.term === 2) {
    state.approval -= 0.4;
    // Lame duck effect after day 160
    if (state.day > 160) state.approval -= 0.3;
  }

  updateHUD(false);
  showOrder();
}

// ==================== CRISIS ====================
function triggerCrisis() {
  const crisis = CRISES[Math.floor(Math.random() * CRISES.length)];
  state.crisesHandled++;

  const overlay = document.getElementById('crisis-overlay');
  document.getElementById('crisis-title').textContent = crisis.title;
  document.getElementById('crisis-desc').textContent = crisis.desc;

  const optionsEl = document.getElementById('crisis-options');
  optionsEl.innerHTML = crisis.options.map((opt, i) => `
    <div class="crisis-option" onclick="resolveCrisis(${i})">
      <div class="crisis-option-title">${opt.title}</div>
      <div class="crisis-option-desc">${opt.desc}</div>
    </div>
  `).join('');

  state.currentCrisis = crisis;
  overlay.classList.add('active');
  gsap.fromTo('.crisis-card', { scale: 0.9, opacity: 0 }, { scale: 1, opacity: 1, duration: 0.4, ease: 'back.out(1.4)' });
}

function resolveCrisis(idx) {
  const opt = state.currentCrisis.options[idx];
  Object.entries(opt.effect).forEach(([k,v]) => { state[k] += v; });
  if (opt.facEffect) Object.entries(opt.facEffect).forEach(([k,v]) => { state.factions[k] += v; });
  if (opt.capitalCost) state.budget = Math.max(0, state.budget - opt.capitalCost);

  const overlay = document.getElementById('crisis-overlay');
  gsap.to('.crisis-card', { scale: 0.9, opacity: 0, duration: 0.3, onComplete: () => {
    overlay.classList.remove('active');
    updateHUD(true);
    showToast('Crisis Resolved', opt.title, 2000);
    setTimeout(() => {
      if (checkGameOver()) return;
      proceedToNextDay();
    }, 1200);
  }});
}

// ==================== ELECTION ====================
function triggerElection() {
  const overlay = document.getElementById('election-overlay');
  const card = document.getElementById('election-card');

  // Election outcome based on stats + factions
  const score = state.approval * 0.4 + state.economy * 0.25 + state.security * 0.15 + state.liberty * 0.1
    + (state.factions.congress * 0.05 + state.factions.media * 0.05);
  const win = score > 35;
  const margin = Math.abs(score - 35);

  if (win) {
    card.innerHTML = `
      <div class="election-icon">üá∫üá∏</div>
      <div class="election-title">RE-ELECTED!</div>
      <div class="election-desc">The people have spoken. You've earned four more years.</div>
      <div class="election-result">${Math.min(62, 50 + Math.round(margin * 0.4))}% - ${Math.max(38, 50 - Math.round(margin * 0.4))}%</div>
      <div class="election-sub">Electoral College Victory</div>
      <button class="btn-primary" onclick="startTerm2()">BEGIN TERM 2</button>
    `;
  } else {
    card.innerHTML = `
      <div class="election-icon">üìâ</div>
      <div class="election-title">DEFEATED</div>
      <div class="election-desc">The voters chose someone else. Your presidency ends here.</div>
      <div class="election-result">${Math.max(38, 50 - Math.round(margin * 0.4))}% - ${Math.min(62, 50 + Math.round(margin * 0.4))}%</div>
      <div class="election-sub">Electoral College Defeat</div>
      <button class="btn-primary" onclick="showGameOver('DEFEATED', 'You lost re-election. The voters wanted change.')">ACCEPT RESULTS</button>
    `;
  }

  overlay.classList.add('active');
  gsap.fromTo('.election-card', { scale: 0.9, opacity: 0 }, { scale: 1, opacity: 1, duration: 0.5, ease: 'back.out(1.4)' });
}

function startTerm2() {
  document.getElementById('election-overlay').classList.remove('active');
  state.term = 2;
  state.budget += 30; // Re-election mandate bonus
  state.approval = Math.min(100, state.approval + 10);
  // Reset some faction hostility
  Object.keys(state.factions).forEach(f => { state.factions[f] = Math.min(100, state.factions[f] + 10); });
  updateHUD(true);
  showToast('TERM 2 BEGINS', 'Difficulty increased. The clock is ticking.', 2500);
  setTimeout(() => proceedToNextDay(), 1500);
}

// ==================== GAME OVER ====================
function checkGameOver() {
  let reason = '', title = '';
  if (state.approval <= 0) { title = 'VOTED OUT'; reason = 'Approval hit 0%. The people have spoken.'; }
  else if (state.economy <= 0) { title = 'ECONOMIC COLLAPSE'; reason = 'The economy imploded. Banks failed. You\'re blamed for everything.'; }
  else if (state.security <= 0) { title = 'NATIONAL CRISIS'; reason = 'Security collapsed. The nation is vulnerable. You\'ve been removed.'; }
  else if (state.liberty <= 0) { title = 'IMPEACHED'; reason = 'Civil liberties gone. The Supreme Court removed you as a tyrant.'; }

  // Term 2 end
  if (state.term === 2 && state.day >= 200 && !reason) {
    title = 'LEGACY SECURED';
    reason = 'You served two full terms. History will judge you.';
  }

  if (!reason && !(state.term === 2 && state.day >= 200)) return false;

  state.playing = false;
  showGameOver(title, reason);
  return true;
}

function showGameOver(title, reason) {
  state.playing = false;
  document.getElementById('election-overlay').classList.remove('active');
  document.getElementById('crisis-overlay').classList.remove('active');
  document.getElementById('go-title').textContent = title;
  document.getElementById('go-reason').textContent = reason;
  document.getElementById('go-days').textContent = state.day;
  document.getElementById('go-signed').textContent = state.signed;
  document.getElementById('go-vetoed').textContent = state.vetoed;
  document.getElementById('go-crises').textContent = state.crisesHandled;
  document.getElementById('go-term').textContent = state.term;
  setTimeout(() => {
    showScreen('gameover-screen');
    gsap.fromTo('#gameover-screen', { opacity: 0 }, { opacity: 1, duration: 0.5 });
  }, 600);
}

// ==================== START ====================
function startGame() {
  state = initState();
  state.orderQueue = shuffleOrders();
  state.playing = true;
  updateHUD(false);
  showScreen('game-screen');
  gsap.fromTo('#game-screen', { opacity: 0 }, { opacity: 1, duration: 0.4 });
  showOrder();
}
</script>
</body>
</html>
