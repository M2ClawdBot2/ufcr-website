<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EXECUTIVE ORDER — UFCR</title>
  <meta name="description" content="Sign or veto. Shape the nation. Survive.">
  <link rel="icon" href="../assets/images/shield-logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Oswald:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0D0D12;
      --card-bg: #15161E;
      --card-border: #22232E;
      --gold: #D4A843;
      --gold-dim: #8A7132;
      --red: #C0392B;
      --green: #27AE60;
      --cyan: #2E86AB;
      --purple: #7D3C98;
      --orange: #D35400;
      --text: #E0DDD4;
      --text-dim: #6B6960;
      --font-body: 'Inter', monospace;
      --font-heading: 'Oswald', sans-serif;
    }
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { font-size: 16px; -webkit-font-smoothing: antialiased; }
    body { font-family: var(--font-body); background: var(--bg); color: var(--text); overflow-x: hidden; min-height: 100vh; }
    a { text-decoration: none; color: inherit; }

    /* NAV */
    .nav {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100; height: 48px;
      background: #0A0A0F; border-bottom: 1px solid #1A1B22;
    }
    .nav-inner {
      max-width: 600px; margin: 0 auto; padding: 0 16px; height: 100%;
      display: flex; align-items: center; justify-content: space-between;
    }
    .nav-logo { display: flex; align-items: center; gap: 8px; }
    .nav-logo img { height: 28px; border-radius: 4px; background: white; padding: 2px; }
    .nav-logo span { font-family: var(--font-heading); font-size: 1rem; font-weight: 700; letter-spacing: 0.1em; color: var(--gold); }
    .nav-back { font-size: 0.75rem; color: var(--text-dim); }
    .nav-back:hover { color: var(--gold); }

    .screen { display: none; }
    .screen.active { display: flex; flex-direction: column; align-items: center; }

    /* TITLE SCREEN */
    #title-screen {
      justify-content: center; min-height: 100vh; padding: 60px 20px 40px;
    }
    .title-icon-wrap { margin-bottom: 24px; position: relative; }
    .title-icon-wrap canvas { display: block; }
    .title-heading {
      font-family: var(--font-heading); font-size: clamp(2rem, 6vw, 3rem);
      font-weight: 700; letter-spacing: 0.1em; text-align: center;
      color: var(--gold); margin-bottom: 8px;
    }
    .title-sub {
      font-size: 0.85rem; color: var(--text-dim); text-align: center;
      max-width: 360px; line-height: 1.6; margin-bottom: 32px;
    }
    .btn-play {
      padding: 14px 48px; border: 2px solid var(--gold); border-radius: 2px;
      background: transparent; cursor: pointer;
      font-family: var(--font-heading); font-size: 1.1rem; font-weight: 600;
      letter-spacing: 0.12em; color: var(--gold);
      transition: background 0.3s, color 0.3s;
    }
    .btn-play:hover { background: var(--gold); color: var(--bg); }

    /* GAME SCREEN */
    #game-screen { padding: 56px 0 16px; min-height: 100vh; width: 100%; max-width: 600px; margin: 0 auto; }

    /* HUD */
    .hud-bar-row {
      display: flex; width: 100%; padding: 8px 16px; gap: 0;
      background: #0A0A0F; border-bottom: 1px solid #1A1B22;
    }
    .hud-stat {
      flex: 1; text-align: center; position: relative;
      padding: 6px 2px;
    }
    .hud-stat + .hud-stat { border-left: 1px solid #1A1B22; }
    .hud-stat svg { display: block; margin: 0 auto 2px; }
    .hud-stat-val {
      font-family: var(--font-heading); font-size: 1rem; font-weight: 700;
      transition: color 0.3s;
    }
    .hud-stat-bar {
      width: 70%; height: 3px; margin: 3px auto 0; background: #1E1F28;
      border-radius: 1px; overflow: hidden;
    }
    .hud-stat-fill { height: 100%; transition: width 0.6s ease; }

    /* INFO ROW */
    .info-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px 16px; width: 100%;
      font-size: 0.7rem; color: var(--text-dim); letter-spacing: 0.08em;
      font-family: var(--font-heading); text-transform: uppercase;
    }

    /* FACTION ROW */
    .faction-row {
      display: flex; width: 100%; padding: 0 16px 8px; gap: 6px;
    }
    .faction-chip {
      flex: 1; text-align: center; padding: 6px 4px;
      background: #111118; border: 1px solid #1E1F28; border-radius: 2px;
      transition: border-color 0.5s, background 0.5s;
    }
    .faction-chip.hostile { border-color: #5C1A14; background: #1A0E0C; }
    .faction-chip.friendly { border-color: #1A4A2A; background: #0C1A12; }
    .faction-chip svg { display: block; margin: 0 auto 2px; }
    .faction-chip-name { font-size: 0.5rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-dim); }
    .faction-chip-val { font-family: var(--font-heading); font-size: 0.8rem; font-weight: 600; }

    /* ADVISOR SCREEN */
    .advisor-view {
      width: 100%; padding: 0 16px; flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: center; min-height: 380px;
    }
    .advisor-portrait { margin-bottom: 12px; position: relative; }
    .advisor-portrait canvas { display: block; image-rendering: pixelated; }
    .advisor-speech {
      background: var(--card-bg); border: 1px solid var(--card-border);
      border-radius: 2px; padding: 16px 20px; max-width: 400px; width: 100%;
      margin-bottom: 12px; position: relative;
    }
    .advisor-speech::before {
      content: ''; position: absolute; top: -8px; left: 50%; transform: translateX(-50%);
      border-left: 8px solid transparent; border-right: 8px solid transparent;
      border-bottom: 8px solid var(--card-border);
    }
    .advisor-speech-text {
      font-size: 0.9rem; line-height: 1.55; color: var(--text);
      font-style: italic; text-align: center;
    }
    .advisor-info { text-align: center; margin-bottom: 16px; }
    .advisor-info-name {
      font-family: var(--font-heading); font-size: 0.95rem; font-weight: 600;
      color: var(--gold); letter-spacing: 0.06em;
    }
    .advisor-info-title { font-size: 0.65rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.1em; }
    .btn-continue {
      padding: 10px 32px; border: 1px solid var(--text-dim); border-radius: 2px;
      background: transparent; cursor: pointer; font-family: var(--font-heading);
      font-size: 0.8rem; font-weight: 600; letter-spacing: 0.1em; color: var(--text-dim);
      transition: border-color 0.3s, color 0.3s;
    }
    .btn-continue:hover { border-color: var(--gold); color: var(--gold); }

    /* ORDER CARD (Reigns-style) */
    .order-view {
      width: 100%; padding: 0 16px; flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: center; min-height: 380px;
    }
    .order-card-wrap {
      width: 100%; max-width: 380px; perspective: 800px;
    }
    .order-card {
      background: var(--card-bg); border: 1px solid var(--card-border);
      border-radius: 4px; overflow: hidden;
      transition: transform 0.1s ease;
    }
    .order-card-top {
      display: flex; align-items: center; gap: 10px;
      padding: 14px 16px; border-bottom: 1px solid #1A1B22;
    }
    .order-card-icon canvas { display: block; image-rendering: pixelated; }
    .order-card-cat { font-size: 0.55rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-dim); }
    .order-card-title { font-family: var(--font-heading); font-size: 1rem; font-weight: 600; }
    .order-card-body { padding: 14px 16px; }
    .order-card-desc { font-size: 0.82rem; line-height: 1.55; color: var(--text-dim); margin-bottom: 10px; }
    .order-card-cost {
      display: inline-flex; align-items: center; gap: 4px; font-size: 0.7rem;
      padding: 3px 8px; border: 1px solid #2E2F38; border-radius: 2px;
      color: var(--cyan); font-weight: 600; margin-bottom: 10px;
    }
    .order-card-effects { display: flex; flex-wrap: wrap; gap: 5px; }
    .order-card-effect {
      font-size: 0.65rem; padding: 2px 7px; border-radius: 2px; font-weight: 600;
    }
    .order-card-effect.pos { background: #0E2016; color: var(--green); }
    .order-card-effect.neg { background: #200E0C; color: var(--red); }
    .order-card-actions {
      display: flex; gap: 0; border-top: 1px solid #1A1B22;
    }
    .btn-order {
      flex: 1; padding: 14px; border: none; cursor: pointer;
      font-family: var(--font-heading); font-size: 0.9rem; font-weight: 600;
      letter-spacing: 0.08em; transition: background 0.2s;
    }
    .btn-order.sign { background: #0E2016; color: var(--green); border-right: 1px solid #1A1B22; }
    .btn-order.veto { background: #200E0C; color: var(--red); }
    .btn-order.sign:hover { background: #142E1E; }
    .btn-order.veto:hover { background: #2E1410; }
    .btn-order:disabled { opacity: 0.3; cursor: not-allowed; }

    /* TOAST */
    .toast {
      position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%) translateY(80px);
      background: #0A0A0F; border: 1px solid var(--card-border);
      border-radius: 2px; padding: 12px 18px; max-width: 380px; width: calc(100% - 32px);
      z-index: 200; opacity: 0;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    .toast-title { font-family: var(--font-heading); font-size: 0.75rem; color: var(--gold); letter-spacing: 0.08em; }
    .toast-text { font-size: 0.75rem; color: var(--text-dim); line-height: 1.4; margin-top: 2px; }

    /* CRISIS OVERLAY */
    .overlay { position: fixed; inset: 0; z-index: 300; display: none; align-items: center; justify-content: center; padding: 16px; background: rgba(0,0,0,0.8); }
    .overlay.active { display: flex; }
    .overlay-card {
      width: 100%; max-width: 420px; background: #0F0F14; border: 1px solid #2A1A1A;
      border-radius: 4px; overflow: hidden;
    }
    .overlay-header {
      padding: 18px; text-align: center; border-bottom: 1px solid #2A1A1A;
      background: linear-gradient(180deg, #1A0E0C 0%, transparent 100%);
    }
    .overlay-label { font-size: 0.55rem; text-transform: uppercase; letter-spacing: 0.15em; color: var(--red); margin-bottom: 4px; }
    .overlay-title { font-family: var(--font-heading); font-size: 1.1rem; }
    .overlay-body { padding: 16px; }
    .overlay-desc { font-size: 0.82rem; line-height: 1.55; color: var(--text-dim); margin-bottom: 14px; }
    .overlay-options { display: flex; flex-direction: column; gap: 8px; }
    .overlay-option {
      padding: 12px 14px; border: 1px solid #22232E; background: #111118;
      border-radius: 2px; cursor: pointer; transition: border-color 0.3s, background 0.3s;
    }
    .overlay-option:hover { border-color: var(--gold-dim); background: #18181F; }
    .overlay-option-title { font-family: var(--font-heading); font-size: 0.85rem; font-weight: 600; }
    .overlay-option-desc { font-size: 0.7rem; color: var(--text-dim); margin-top: 2px; }

    /* ELECTION */
    .election-card {
      width: 100%; max-width: 420px; background: #0F0F14; border: 1px solid #2A2A1A;
      border-radius: 4px; text-align: center; padding: 32px 24px;
    }
    .election-card canvas { display: block; margin: 0 auto 16px; image-rendering: pixelated; }
    .election-title { font-family: var(--font-heading); font-size: 1.4rem; color: var(--gold); margin-bottom: 8px; }
    .election-desc { font-size: 0.85rem; color: var(--text-dim); line-height: 1.5; margin-bottom: 20px; }
    .election-result { font-family: var(--font-heading); font-size: 1.6rem; color: var(--gold); margin-bottom: 4px; }
    .election-sub { font-size: 0.7rem; color: var(--text-dim); margin-bottom: 20px; }

    /* GAME OVER */
    #gameover-screen { justify-content: center; min-height: 100vh; padding: 60px 20px 40px; text-align: center; }
    .go-title { font-family: var(--font-heading); font-size: clamp(1.6rem, 5vw, 2.4rem); color: var(--gold); margin-bottom: 8px; }
    .go-reason { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 24px; max-width: 360px; line-height: 1.5; }
    .go-stats { display: flex; gap: 16px; margin-bottom: 28px; flex-wrap: wrap; justify-content: center; }
    .go-stat { text-align: center; }
    .go-stat-val { font-family: var(--font-heading); font-size: 1.5rem; font-weight: 700; color: var(--gold); }
    .go-stat-lbl { font-size: 0.55rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-dim); }

    /* STARFIELD */
    #stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
    .screen { position: relative; z-index: 1; }

    @media (max-width: 500px) {
      .hud-stat-val { font-size: 0.85rem; }
      .faction-row { padding: 0 10px 6px; gap: 4px; }
    }
  </style>
</head>
<body>

<canvas id="stars"></canvas>

<nav class="nav">
  <div class="nav-inner">
    <a href="../" class="nav-logo"><img src="../assets/images/shield-logo.png" alt="UFCR"><span>UFCR</span></a>
    <a href="../games/" class="nav-back">GAMES</a>
  </div>
</nav>

<!-- TITLE -->
<div id="title-screen" class="screen active">
  <div class="title-icon-wrap"><canvas id="title-seal" width="100" height="100"></canvas></div>
  <h1 class="title-heading">EXECUTIVE ORDER</h1>
  <p class="title-sub">Sign or veto. Manage factions. Survive crises. Win re-election — or be removed.</p>
  <button class="btn-play" onclick="startGame()">TAKE OFFICE</button>
</div>

<!-- GAME -->
<div id="game-screen" class="screen">
  <div class="hud-bar-row" id="hud-row"></div>
  <div class="info-row">
    <span id="day-label">DAY 1</span>
    <span id="term-label">TERM 1</span>
    <span id="budget-label">CAPITAL: 100</span>
  </div>
  <div class="faction-row" id="faction-row"></div>
  <div id="game-content"></div>
</div>

<!-- GAME OVER -->
<div id="gameover-screen" class="screen">
  <h1 class="go-title" id="go-title">REMOVED</h1>
  <p class="go-reason" id="go-reason"></p>
  <div class="go-stats" id="go-stats"></div>
  <button class="btn-play" onclick="startGame()">RUN AGAIN</button>
</div>

<div class="toast" id="toast">
  <div class="toast-title" id="toast-title"></div>
  <div class="toast-text" id="toast-text"></div>
</div>

<div class="overlay" id="crisis-overlay">
  <div class="overlay-card">
    <div class="overlay-header">
      <div class="overlay-label">CONSTITUTIONAL CRISIS</div>
      <div class="overlay-title" id="crisis-title"></div>
    </div>
    <div class="overlay-body">
      <div class="overlay-desc" id="crisis-desc"></div>
      <div class="overlay-options" id="crisis-options"></div>
    </div>
  </div>
</div>

<div class="overlay" id="election-overlay">
  <div class="election-card" id="election-card"></div>
</div>

<script>
// ==================== LOW-POLY CHARACTER RENDERER ====================
const CHAR_PALETTES = {
  general: { skin: '#D4A07A', hair: '#4A4A4A', suit: '#2C3E2C', accent: '#8B7355', detail: '#1A2A1A' },
  economist: { skin: '#C49070', hair: '#2C2C2C', suit: '#1A2A3E', accent: '#4A6B8A', detail: '#0D1A2A' },
  senator: { skin: '#E0B090', hair: '#6B5B4A', suit: '#2A1A2E', accent: '#6B4A8A', detail: '#1A0D2A' },
  lobbyist: { skin: '#BF9070', hair: '#1A1A1A', suit: '#1A1A1A', accent: '#C0392B', detail: '#0D0D0D' },
  spook: { skin: '#C8A888', hair: '#3A3A3A', suit: '#1E1E1E', accent: '#2E2E2E', detail: '#0A0A0A' },
  pundit: { skin: '#D4B090', hair: '#8B6B4A', suit: '#3E2A1A', accent: '#D35400', detail: '#2A1A0D' },
  diplomat: { skin: '#C09878', hair: '#2A2A3A', suit: '#1A2040', accent: '#2E86AB', detail: '#0D1020' },
  techbro: { skin: '#D0A880', hair: '#3A3020', suit: '#2A2A2A', accent: '#27AE60', detail: '#1A1A1A' },
};

function drawLowPolyHead(canvas, palette, seed) {
  const ctx = canvas.getContext('2d');
  const w = canvas.width, h = canvas.height;
  ctx.clearRect(0, 0, w, h);

  const s = w / 80; // scale factor
  const p = CHAR_PALETTES[palette] || CHAR_PALETTES.general;
  const rng = mulberry32(seed);

  // Head shape - angular low-poly
  ctx.fillStyle = p.skin;
  ctx.beginPath();
  ctx.moveTo(28*s, 14*s);
  ctx.lineTo(52*s, 14*s);
  ctx.lineTo(56*s, 22*s);
  ctx.lineTo(58*s, 38*s);
  ctx.lineTo(54*s, 50*s);
  ctx.lineTo(46*s, 56*s);
  ctx.lineTo(34*s, 56*s);
  ctx.lineTo(26*s, 50*s);
  ctx.lineTo(22*s, 38*s);
  ctx.lineTo(24*s, 22*s);
  ctx.closePath();
  ctx.fill();

  // Hair
  ctx.fillStyle = p.hair;
  ctx.beginPath();
  ctx.moveTo(24*s, 24*s);
  ctx.lineTo(26*s, 12*s);
  ctx.lineTo(32*s, 8*s);
  ctx.lineTo(48*s, 8*s);
  ctx.lineTo(54*s, 12*s);
  ctx.lineTo(56*s, 24*s);
  ctx.lineTo(52*s, 16*s);
  ctx.lineTo(28*s, 16*s);
  ctx.closePath();
  ctx.fill();

  // Eyes - angular
  ctx.fillStyle = '#0D0D0D';
  // Left eye
  ctx.beginPath();
  ctx.moveTo(32*s, 30*s); ctx.lineTo(36*s, 28*s); ctx.lineTo(38*s, 30*s);
  ctx.lineTo(36*s, 32*s); ctx.lineTo(32*s, 32*s); ctx.closePath(); ctx.fill();
  // Right eye
  ctx.beginPath();
  ctx.moveTo(42*s, 30*s); ctx.lineTo(44*s, 28*s); ctx.lineTo(48*s, 30*s);
  ctx.lineTo(48*s, 32*s); ctx.lineTo(44*s, 32*s); ctx.closePath(); ctx.fill();

  // Nose - simple angular
  ctx.fillStyle = darken(p.skin, 20);
  ctx.beginPath();
  ctx.moveTo(40*s, 34*s); ctx.lineTo(42*s, 42*s); ctx.lineTo(38*s, 42*s); ctx.closePath(); ctx.fill();

  // Mouth
  ctx.fillStyle = '#2A1A1A';
  ctx.beginPath();
  ctx.moveTo(35*s, 46*s); ctx.lineTo(45*s, 46*s); ctx.lineTo(43*s, 48*s); ctx.lineTo(37*s, 48*s); ctx.closePath(); ctx.fill();

  // Shoulders / suit
  ctx.fillStyle = p.suit;
  ctx.beginPath();
  ctx.moveTo(16*s, 72*s); ctx.lineTo(24*s, 56*s); ctx.lineTo(34*s, 58*s);
  ctx.lineTo(40*s, 62*s); ctx.lineTo(46*s, 58*s); ctx.lineTo(56*s, 56*s);
  ctx.lineTo(64*s, 72*s); ctx.lineTo(64*s, 80*s); ctx.lineTo(16*s, 80*s);
  ctx.closePath(); ctx.fill();

  // Collar / accent
  ctx.fillStyle = p.accent;
  ctx.beginPath();
  ctx.moveTo(34*s, 58*s); ctx.lineTo(40*s, 66*s); ctx.lineTo(46*s, 58*s);
  ctx.lineTo(42*s, 60*s); ctx.lineTo(40*s, 62*s); ctx.lineTo(38*s, 60*s);
  ctx.closePath(); ctx.fill();

  // Tie
  ctx.fillStyle = p.detail;
  ctx.beginPath();
  ctx.moveTo(39*s, 62*s); ctx.lineTo(41*s, 62*s); ctx.lineTo(41.5*s, 74*s);
  ctx.lineTo(40*s, 76*s); ctx.lineTo(38.5*s, 74*s); ctx.closePath(); ctx.fill();

  // Facial variation based on seed
  const variant = Math.floor(rng() * 4);
  if (variant === 0) {
    // Glasses
    ctx.strokeStyle = '#3A3A3A'; ctx.lineWidth = 1.5*s;
    ctx.beginPath(); ctx.rect(30*s, 27*s, 10*s, 7*s); ctx.stroke();
    ctx.beginPath(); ctx.rect(42*s, 27*s, 10*s, 7*s); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(40*s, 30*s); ctx.lineTo(42*s, 30*s); ctx.stroke();
  } else if (variant === 1) {
    // Scar
    ctx.strokeStyle = darken(p.skin, 30); ctx.lineWidth = 1*s;
    ctx.beginPath(); ctx.moveTo(48*s, 24*s); ctx.lineTo(50*s, 34*s); ctx.stroke();
  } else if (variant === 2) {
    // Beard shadow
    ctx.fillStyle = darken(p.skin, 15) + '80';
    ctx.beginPath();
    ctx.moveTo(28*s, 42*s); ctx.lineTo(52*s, 42*s); ctx.lineTo(50*s, 52*s);
    ctx.lineTo(40*s, 56*s); ctx.lineTo(30*s, 52*s); ctx.closePath(); ctx.fill();
  }
}

function mulberry32(a) {
  return function() {
    a |= 0; a = a + 0x6D2B79F5 | 0;
    var t = Math.imul(a ^ a >>> 15, 1 | a);
    t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t;
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  }
}

function darken(hex, amt) {
  let r = parseInt(hex.slice(1,3),16), g = parseInt(hex.slice(3,5),16), b = parseInt(hex.slice(5,7),16);
  r = Math.max(0, r - amt); g = Math.max(0, g - amt); b = Math.max(0, b - amt);
  return '#' + [r,g,b].map(c => c.toString(16).padStart(2,'0')).join('');
}

// ==================== SVG ICONS (no emoji) ====================
function iconSVG(name, size, color) {
  const s = size || 18;
  const c = color || 'currentColor';
  const icons = {
    approval: `<svg width="${s}" height="${s}" viewBox="0 0 24 24" fill="none"><path d="M12 2L9 9H2l6 4.5L5.5 21 12 16.5 18.5 21 16 13.5 22 9h-7L12 2z" fill="${c}"/></svg>`,
    economy: `<svg width="${s}" height="${s}" viewBox="0 0 24 24" fill="none"><path d="M12 2v20M8 6l4-4 4 4M6 18h12M8 14h8M10 10h4" stroke="${c}" stroke-width="2"/></svg>`,
    security: `<svg width="${s}" height="${s}" viewBox="0 0 24 24" fill="none"><path d="M12 2L4 6v6c0 5.5 3.4 10.3 8 12 4.6-1.7 8-6.5 8-12V6L12 2z" fill="${c}"/></svg>`,
    liberty: `<svg width="${s}" height="${s}" viewBox="0 0 24 24" fill="none"><path d="M12 2C8 2 4 6 4 12s4 10 8 10 8-4 8-10-4-10-8-10zm0 4l2 4h4l-3 3 1 4-4-2-4 2 1-4-3-3h4l2-4z" fill="${c}"/></svg>`,
    congress: `<svg width="${s}" height="${s}" viewBox="0 0 24 24" fill="none"><path d="M3 21h18M5 21V11l7-8 7 8v10M10 21v-6h4v6" stroke="${c}" stroke-width="1.5"/></svg>`,
    media: `<svg width="${s}" height="${s}" viewBox="0 0 24 24" fill="none"><rect x="2" y="4" width="20" height="14" rx="1" stroke="${c}" stroke-width="1.5"/><path d="M2 22h20M10 18v4M14 18v4" stroke="${c}" stroke-width="1.5"/></svg>`,
    military: `<svg width="${s}" height="${s}" viewBox="0 0 24 24" fill="none"><path d="M12 2l3 6h6l-5 4 2 6-6-4-6 4 2-6-5-4h6l3-6z" fill="${c}"/></svg>`,
    wallst: `<svg width="${s}" height="${s}" viewBox="0 0 24 24" fill="none"><path d="M4 20L8 12l4 4 4-8 4 6" stroke="${c}" stroke-width="2"/></svg>`,
    capital: `<svg width="${s}" height="${s}" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="${c}" stroke-width="1.5"/><path d="M12 6v12M8 10h8M8 14h8" stroke="${c}" stroke-width="1.5"/></svg>`,
  };
  return icons[name] || '';
}

function catIconCanvas(cat) {
  const canvas = document.createElement('canvas');
  canvas.width = 32; canvas.height = 32;
  const ctx = canvas.getContext('2d');
  const colors = {
    Immigration: '#FA4616', Economy: '#2E86AB', Security: '#D4A843',
    Liberty: '#7D3C98', Classified: '#C0392B', 'Executive Power': '#D4A843',
    'Foreign Policy': '#2E86AB'
  };
  const col = colors[cat] || '#D4A843';
  // Simple angular icon
  ctx.fillStyle = col;
  ctx.beginPath();
  ctx.moveTo(16, 2); ctx.lineTo(28, 10); ctx.lineTo(24, 26);
  ctx.lineTo(8, 26); ctx.lineTo(4, 10); ctx.closePath(); ctx.fill();
  ctx.fillStyle = '#0D0D12';
  ctx.fillRect(12, 10, 8, 2);
  ctx.fillRect(14, 14, 4, 8);
  return canvas;
}

// ==================== ADVISORS (expanded) ====================
const ADVISORS = [
  { id: 'hayes', name: 'Gen. Marcus Hayes', title: 'Secretary of Defense', palette: 'general', seed: 1001,
    bias: 'security', weight: 1.2,
    pro: ["This is a matter of national security, Mr. President. We must act.", "Our forces are ready. This order gives us the strength we need.",
          "Every day we delay, our enemies grow bolder."],
    con: ["This undermines our military readiness, sir.", "Our generals are deeply concerned about this course of action.",
          "This will embolden every hostile nation watching us."] },
  { id: 'chen', name: 'Dr. Margaret Chen', title: 'Chief Economic Advisor', palette: 'economist', seed: 2002,
    bias: 'economy', weight: 1.2,
    pro: ["The numbers are clear — this will drive growth.", "Markets are pricing this in favorably. Good for jobs.",
          "This is textbook sound economic policy."],
    con: ["The fiscal impact alone will be devastating.", "Wall Street will crater if you sign this.",
          "We cannot afford this. The deficit is already ballooning."] },
  { id: 'blake', name: 'Sen. Robert Blake', title: 'Congressional Liaison', palette: 'senator', seed: 3003,
    bias: 'approval', weight: 1.0,
    pro: ["This polls extremely well. Your base wants this.", "I can get you votes on both sides of the aisle for this.",
          "Politically, this is a home run."],
    con: ["You'll lose the swing voters on this one.", "The Hill is already sharpening their knives over this.",
          "This is political suicide, Mr. President."] },
  { id: 'torres', name: 'Victoria Torres', title: 'Civil Liberties Counsel', palette: 'diplomat', seed: 4004,
    bias: 'liberty', weight: 1.2,
    pro: ["This expands individual freedom. The founders would approve.", "A principled stand for liberty. I support this fully.",
          "This is what limited government looks like."],
    con: ["This is executive overreach, plain and simple.", "The ACLU will have a field day. And they'll be right.",
          "We're setting a precedent that will haunt every future president."] },
  { id: 'kruger', name: 'Jack Kruger', title: 'K Street Lobbyist', palette: 'lobbyist', seed: 5005,
    bias: 'economy', weight: 0.8,
    pro: ["My clients are very enthusiastic about this direction.", "This opens up tremendous... opportunities.",
          "The private sector is ready to pour money behind this."],
    con: ["My clients are... concerned. Very concerned.", "This will dry up your donor pipeline overnight.",
          "You're making powerful enemies with this one, Mr. President."] },
  { id: 'webb', name: 'Director Sarah Webb', title: 'Intelligence Community', palette: 'spook', seed: 6006,
    bias: 'security', weight: 1.0,
    pro: ["Our intelligence supports this action. The threat is real.", "Classified briefings align with this decision.",
          "This will strengthen our intelligence capabilities significantly."],
    con: ["Sources indicate this will compromise ongoing operations.", "The intelligence community has... reservations.",
          "This creates vulnerabilities our adversaries will exploit."] },
  { id: 'mason', name: 'Tucker Mason', title: 'Media Strategist', palette: 'pundit', seed: 7007,
    bias: 'approval', weight: 0.9,
    pro: ["This will dominate the news cycle in your favor.", "I can spin this six ways to Sunday. Great optics.",
          "The base will eat this up. Social media will explode."],
    con: ["Every network will run this as their lead. Negatively.", "The optics are terrible. I can't fix this one.",
          "Twitter will be on fire. And not in a good way."] },
  { id: 'park', name: 'Ambassador David Park', title: 'Foreign Affairs Advisor', palette: 'diplomat', seed: 8008,
    bias: 'security', weight: 0.8,
    pro: ["Our allies will view this favorably. Strength begets respect.", "This sends the right message to the international community.",
          "Strategic positioning at its finest, Mr. President."],
    con: ["Our allies will not understand this. Expect backlash.", "This isolates us on the world stage.",
          "NATO will have serious questions. So will our adversaries."] },
  { id: 'vance', name: 'Eric Vance', title: 'Silicon Valley Liaison', palette: 'techbro', seed: 9009,
    bias: 'economy', weight: 0.7,
    pro: ["The tech sector is all in on this. Innovation will follow.", "This is forward-thinking policy. Silicon Valley approves.",
          "Disruptive in the best way. The future is here."],
    con: ["Tech will route around this. You'll just push innovation offshore.", "The startup ecosystem will freeze up.",
          "This is anti-innovation. The Valley will fight you on this."] },
  { id: 'calloway', name: 'Judge Ruth Calloway', title: 'Constitutional Scholar', palette: 'senator', seed: 1010,
    bias: 'liberty', weight: 1.0,
    pro: ["Constitutionally sound. Article II supports this authority.", "This is well within presidential power. I've reviewed it thoroughly.",
          "The framers intended the executive to have this kind of reach."],
    con: ["This will not survive judicial review.", "I cannot in good conscience say this is constitutional.",
          "Expect an injunction within 48 hours, Mr. President."] },
];

function pickAdvisors(order) {
  const scored = ADVISORS.map(a => {
    const signVal = order.sign[a.bias] || 0;
    const magnitude = Math.abs(signVal) * a.weight + Math.random() * 5;
    return { ...a, magnitude, favorsSign: signVal > 0 };
  });
  scored.sort((a, b) => b.magnitude - a.magnitude);
  // Pick two with ideally conflicting views
  const first = scored[0];
  let second = scored.find(a => a.id !== first.id && a.favorsSign !== first.favorsSign);
  if (!second) second = scored.find(a => a.id !== first.id);
  return [first, second].map(a => ({
    ...a,
    quote: a.favorsSign
      ? a.pro[Math.floor(Math.random() * a.pro.length)]
      : a.con[Math.floor(Math.random() * a.con.length)]
  }));
}

// ==================== ORDERS ====================
const ORDERS = [
  { cat:"Immigration", icon:"fa-passport", cost:8,
    title:"Close the Southern Border", desc:"Deploy the National Guard. Halt all non-essential border crossings.",
    sign:{approval:8,economy:-5,security:15,liberty:-8}, signFac:{congress:-5,media:-10,military:10,wallst:-3},
    veto:{approval:-6,economy:3,security:-10,liberty:5}, vetoFac:{congress:3,media:8,military:-5,wallst:2},
    signEvent:"Border crossings drop 94%. Media melts down.", vetoEvent:"Crossings surge. Open borders crowd celebrates.",
    chain:{delay:3,title:"Humanitarian Crisis",text:"Overcrowded detention facilities spark international outrage.",effect:{approval:-6,liberty:-4},facEffect:{media:-8}}},
  { cat:"Immigration", icon:"fa-helicopter", cost:10,
    title:"Activate ICE Deportation Force", desc:"Massive ICE expansion. Criminal aliens removed from every major city.",
    sign:{approval:10,economy:-3,security:12,liberty:-6}, signFac:{congress:-4,media:-12,military:8,wallst:-2},
    veto:{approval:-8,economy:2,security:-8,liberty:4}, vetoFac:{congress:2,media:6,military:-4,wallst:1},
    signEvent:"Record operations. Sanctuary cities furious.", vetoEvent:"Criminal aliens stay. Crime ticks up."},
  { cat:"Immigration", icon:"fa-wall", cost:12,
    title:"Fund the Border Wall", desc:"Redirect $12B in military funds. Complete the entire southern wall.",
    sign:{approval:6,economy:-8,security:10,liberty:-2}, signFac:{congress:-8,media:-6,military:-3,wallst:-4},
    veto:{approval:-4,economy:5,security:-6,liberty:2}, vetoFac:{congress:4,media:4,military:2,wallst:3},
    signEvent:"Construction begins. Workers hired by thousands.", vetoEvent:"Wall incomplete. Cartels celebrate."},

  { cat:"Economy", icon:"fa-chart", cost:6,
    title:"Slash Corporate Tax to 15%", desc:"Cut corporate taxes. Supercharge business investment.",
    sign:{approval:5,economy:14,security:0,liberty:5}, signFac:{congress:-3,media:-5,military:0,wallst:15},
    veto:{approval:-3,economy:-8,security:0,liberty:-2}, vetoFac:{congress:2,media:3,military:0,wallst:-12},
    signEvent:"Markets surge 800 points. Factories announced.", vetoEvent:"Wall Street disappointed."},
  { cat:"Economy", icon:"fa-gas", cost:5,
    title:"Drill Baby Drill", desc:"Open all federal lands. Kill the red tape on energy permits.",
    sign:{approval:7,economy:12,security:3,liberty:4}, signFac:{congress:3,media:-8,military:2,wallst:10},
    veto:{approval:-5,economy:-6,security:-2,liberty:-1}, vetoFac:{congress:-2,media:6,military:-1,wallst:-6},
    signEvent:"Gas prices plummet. Energy independence.", vetoEvent:"Gas at $6/gallon. OPEC celebrates.",
    chain:{delay:4,title:"Gulf Oil Spill",text:"Massive spill off Louisiana. Environmental disaster.",effect:{approval:-8,economy:-5},facEffect:{media:-10,wallst:-5}}},
  { cat:"Economy", icon:"fa-coins", cost:4,
    title:"No Tax on Tips", desc:"Treasury stops collecting income tax on tipped wages.",
    sign:{approval:12,economy:-4,security:0,liberty:8}, signFac:{congress:-2,media:2,military:0,wallst:-3},
    veto:{approval:-10,economy:3,security:0,liberty:-3}, vetoFac:{congress:1,media:-1,military:0,wallst:2},
    signEvent:"Service workers ecstatic. Restaurants boom.", vetoEvent:"Bartenders across America disappointed."},
  { cat:"Economy", icon:"fa-tariff", cost:7,
    title:"25% Tariff on China", desc:"Massive tariff on all Chinese imports. Protect American manufacturing.",
    sign:{approval:4,economy:-6,security:8,liberty:-3}, signFac:{congress:4,media:-3,military:6,wallst:-10},
    veto:{approval:-3,economy:8,security:-4,liberty:3}, vetoFac:{congress:-3,media:2,military:-3,wallst:8},
    signEvent:"Trade war escalates. Steel producers rejoice.", vetoEvent:"Cheap Chinese goods keep flooding in.",
    chain:{delay:3,title:"China Retaliates",text:"Beijing slaps 40% tariffs on American agriculture.",effect:{approval:-5,economy:-8},facEffect:{congress:-5,wallst:-6}}},
  { cat:"Economy", icon:"fa-btc", cost:8,
    title:"National Bitcoin Reserve", desc:"Treasury purchases 1 million Bitcoin as a strategic reserve.",
    sign:{approval:4,economy:-5,security:2,liberty:10}, signFac:{congress:-8,media:-4,military:-2,wallst:8},
    veto:{approval:-2,economy:3,security:0,liberty:-4}, vetoFac:{congress:3,media:2,military:1,wallst:-3},
    signEvent:"Bitcoin moons. Crypto bros worship you.", vetoEvent:"Crypto community calls you a boomer."},
  { cat:"Economy", icon:"fa-freeze", cost:3,
    title:"Freeze Federal Hiring", desc:"Immediate freeze on all non-essential federal hiring.",
    sign:{approval:6,economy:6,security:-2,liberty:3}, signFac:{congress:2,media:-3,military:-2,wallst:6},
    veto:{approval:-3,economy:-3,security:1,liberty:-1}, vetoFac:{congress:-1,media:2,military:1,wallst:-3},
    signEvent:"Government bloat reduced.", vetoEvent:"Federal workforce keeps growing."},

  { cat:"Security", icon:"fa-shield", cost:12,
    title:"Rebuild the Military", desc:"$100 billion increase. New ships, jets, cyber capabilities.",
    sign:{approval:5,economy:-10,security:15,liberty:-3}, signFac:{congress:-6,media:-4,military:18,wallst:5},
    veto:{approval:-4,economy:6,security:-12,liberty:2}, vetoFac:{congress:3,media:3,military:-15,wallst:-2},
    signEvent:"Pentagon cheers. Aircraft carriers commissioned.", vetoEvent:"Readiness concerns grow."},
  { cat:"Security", icon:"fa-gun", cost:5,
    title:"National Concealed Carry", desc:"All states recognize concealed carry permits from every other state.",
    sign:{approval:6,economy:0,security:5,liberty:14}, signFac:{congress:-5,media:-10,military:4,wallst:0},
    veto:{approval:-5,economy:0,security:-2,liberty:-10}, vetoFac:{congress:3,media:6,military:-2,wallst:0},
    signEvent:"2A supporters celebrate nationwide.", vetoEvent:"Gun rights groups vow primary challenges."},
  { cat:"Security", icon:"fa-tiktok", cost:6,
    title:"Ban TikTok", desc:"Complete ban on TikTok and all ByteDance products.",
    sign:{approval:-5,economy:2,security:12,liberty:-10}, signFac:{congress:5,media:3,military:8,wallst:3},
    veto:{approval:4,economy:-1,security:-8,liberty:6}, vetoFac:{congress:-3,media:-2,military:-4,wallst:-1},
    signEvent:"Gen Z riots. Security experts approve.", vetoEvent:"CCP data collection continues.",
    chain:{delay:2,title:"Gen Z Backlash",text:"Massive protests. Youth voter registration spikes against you.",effect:{approval:-10},facEffect:{media:-6,congress:-4}}},
  { cat:"Security", icon:"fa-space", cost:14,
    title:"Expand Space Force", desc:"Triple the budget. Permanent lunar military presence.",
    sign:{approval:3,economy:-8,security:10,liberty:0}, signFac:{congress:-4,media:2,military:12,wallst:4},
    veto:{approval:-1,economy:5,security:-5,liberty:0}, vetoFac:{congress:2,media:-1,military:-8,wallst:-2},
    signEvent:"Moon base begins. Elon approves.", vetoEvent:"China beats us to the moon."},
  { cat:"Security", icon:"fa-pardon", cost:7,
    title:"Pardon January 6 Defendants", desc:"Blanket pardon for all January 6 defendants.",
    sign:{approval:6,economy:0,security:-5,liberty:8}, signFac:{congress:-10,media:-15,military:-4,wallst:0},
    veto:{approval:-8,economy:0,security:3,liberty:-4}, vetoFac:{congress:5,media:10,military:2,wallst:0},
    signEvent:"Base goes wild. Media melts down.", vetoEvent:"Your base feels deeply betrayed."},

  { cat:"Liberty", icon:"fa-dei", cost:4,
    title:"Ban DEI in Federal Agencies", desc:"Eliminate all DEI programs from the federal government.",
    sign:{approval:8,economy:4,security:0,liberty:6}, signFac:{congress:-3,media:-14,military:3,wallst:4},
    veto:{approval:-6,economy:-2,security:0,liberty:-4}, vetoFac:{congress:2,media:10,military:-2,wallst:-1},
    signEvent:"DEI bureaucrats pack their desks.", vetoEvent:"Mandatory diversity trainings continue."},
  { cat:"Liberty", icon:"fa-school", cost:6,
    title:"School Choice", desc:"Federal education funding follows the student. Parents choose.",
    sign:{approval:7,economy:-3,security:0,liberty:12}, signFac:{congress:-6,media:-5,military:0,wallst:3},
    veto:{approval:-5,economy:2,security:0,liberty:-8}, vetoFac:{congress:4,media:4,military:0,wallst:-1},
    signEvent:"Parents rejoice. Teachers unions declare war.", vetoEvent:"Public school monopoly preserved."},
  { cat:"Liberty", icon:"fa-church", cost:3,
    title:"Protect Religious Liberty", desc:"Government cannot penalize faith-based organizations.",
    sign:{approval:6,economy:0,security:0,liberty:10}, signFac:{congress:2,media:-8,military:2,wallst:0},
    veto:{approval:-4,economy:0,security:0,liberty:-6}, vetoFac:{congress:-1,media:5,military:-1,wallst:0},
    signEvent:"Churches celebrate. ACLU files 47 lawsuits.", vetoEvent:"Faith organizations feel abandoned."},
  { cat:"Liberty", icon:"fa-tech", cost:10,
    title:"Break Up Big Tech", desc:"DOJ pursues antitrust against Google, Meta, Amazon.",
    sign:{approval:9,economy:-7,security:2,liberty:10}, signFac:{congress:5,media:4,military:0,wallst:-14},
    veto:{approval:-6,economy:5,security:-2,liberty:-8}, vetoFac:{congress:-3,media:-3,military:0,wallst:10},
    signEvent:"Silicon Valley panics. Free speech wins.", vetoEvent:"Tech monopolies tighten their grip."},
  { cat:"Liberty", icon:"fa-leaf", cost:5,
    title:"Legalize Cannabis", desc:"Deschedule marijuana. Pardon all federal cannabis offenses.",
    sign:{approval:10,economy:8,security:-4,liberty:12}, signFac:{congress:-4,media:8,military:-3,wallst:6},
    veto:{approval:-6,economy:-3,security:3,liberty:-8}, vetoFac:{congress:2,media:-4,military:2,wallst:-2},
    signEvent:"Snoop Dogg tweets your approval to the moon.", vetoEvent:"Prohibition continues. Black market thrives."},

  { cat:"Classified", icon:"fa-file", cost:7,
    title:"Release the JFK Files", desc:"Declassify everything. No redactions.",
    sign:{approval:14,economy:0,security:-8,liberty:12}, signFac:{congress:-4,media:10,military:-12,wallst:0},
    veto:{approval:-10,economy:0,security:5,liberty:-10}, vetoFac:{congress:2,media:-6,military:8,wallst:0},
    signEvent:"Conspiracy theorists vindicated. CIA director resigns.", vetoEvent:"The truth stays buried."},
  { cat:"Classified", icon:"fa-ufo", cost:6,
    title:"Disclose UFO Programs", desc:"Full UAP/UFO disclosure. Recovered materials. Everything.",
    sign:{approval:8,economy:2,security:-12,liberty:15}, signFac:{congress:3,media:12,military:-15,wallst:2},
    veto:{approval:-4,economy:0,security:8,liberty:-6}, vetoFac:{congress:-1,media:-5,military:10,wallst:0},
    signEvent:"Pentagon admits alien tech. World freaks out.", vetoEvent:"Cover-up continues.",
    chain:{delay:2,title:"Global Panic",text:"World leaders demand answers. Markets crash.",effect:{approval:-5,economy:-10,security:-5},facEffect:{media:8,wallst:-12,military:-8}}},
  { cat:"Executive Power", icon:"fa-gavel", cost:8,
    title:"Abolish the ATF", desc:"Dismantle the Bureau entirely.",
    sign:{approval:5,economy:3,security:-8,liberty:15}, signFac:{congress:-8,media:-6,military:-2,wallst:2},
    veto:{approval:-3,economy:-1,security:5,liberty:-10}, vetoFac:{congress:4,media:3,military:2,wallst:0},
    signEvent:"Gun owners celebrate. ATF agents update resumes.", vetoEvent:"ATF announces expanded operations."},
  { cat:"Executive Power", icon:"fa-term", cost:15,
    title:"Term Limits for Congress", desc:"Constitutional convention for term limits.",
    sign:{approval:15,economy:0,security:0,liberty:8}, signFac:{congress:-20,media:6,military:0,wallst:-2},
    veto:{approval:-12,economy:0,security:0,liberty:-5}, vetoFac:{congress:10,media:-4,military:0,wallst:2},
    signEvent:"Career politicians panic. The people cheer.", vetoEvent:"The swamp breathes a sigh of relief.",
    chain:{delay:2,title:"Congress Strikes Back",text:"Furious Congress launches investigations.",effect:{approval:-8,liberty:-4},facEffect:{congress:-10}}},
  { cat:"Executive Power", icon:"fa-fed", cost:9,
    title:"Audit the Federal Reserve", desc:"Complete public audit of the Fed.",
    sign:{approval:10,economy:-8,security:0,liberty:10}, signFac:{congress:-6,media:4,military:0,wallst:-15},
    veto:{approval:-7,economy:5,security:0,liberty:-6}, vetoFac:{congress:3,media:-2,military:0,wallst:10},
    signEvent:"Markets wobble. Transparency advocates ecstatic.", vetoEvent:"The Fed operates in darkness."},
  { cat:"Foreign Policy", icon:"fa-un", cost:10,
    title:"Withdraw from the UN", desc:"Pull out. Stop all funding immediately.",
    sign:{approval:4,economy:8,security:-6,liberty:6}, signFac:{congress:-6,media:-10,military:4,wallst:3},
    veto:{approval:-2,economy:-4,security:4,liberty:-2}, vetoFac:{congress:3,media:5,military:-2,wallst:-1},
    signEvent:"Globalists in shambles. Full sovereignty.", vetoEvent:"UN continues on your tax dollars."},
  { cat:"Foreign Policy", icon:"fa-aid", cost:6,
    title:"End All Foreign Aid", desc:"Halt everything. Redirect to domestic infrastructure.",
    sign:{approval:7,economy:12,security:-5,liberty:2}, signFac:{congress:2,media:-8,military:-3,wallst:5},
    veto:{approval:-4,economy:-6,security:3,liberty:0}, vetoFac:{congress:-1,media:4,military:2,wallst:-2},
    signEvent:"Billions saved. Roads get funded.", vetoEvent:"Billions overseas. Potholes multiply."},
];

// ==================== CRISES ====================
const CRISES = [
  { title:"Supreme Court Blocks Your Order", desc:"Your latest executive order ruled unconstitutional. Comply or defy?",
    options:[
      { title:"Comply with the ruling", desc:"Respect the Court. Your base won't like it.",
        effect:{approval:-8,liberty:6}, facEffect:{congress:8,media:6,military:2} },
      { title:"Defy the Court", desc:"Ignore it. Assert executive supremacy.",
        effect:{approval:5,liberty:-15,security:5}, facEffect:{congress:-15,media:-12,military:-5} }
    ]},
  { title:"Assassination Attempt", desc:"Shots fired at your rally. You survive. The nation watches.",
    options:[
      { title:"Call for unity", desc:"Use the moment to unite the country.",
        effect:{approval:15,security:-3,liberty:3}, facEffect:{congress:8,media:10,military:5} },
      { title:"Crack down", desc:"Expand surveillance. Never again.",
        effect:{approval:5,security:15,liberty:-12}, facEffect:{congress:-4,media:-8,military:10} }
    ]},
  { title:"Government Shutdown", desc:"Congress refuses a budget. Shutdown in 24 hours.",
    options:[
      { title:"Negotiate", desc:"Spend political capital. Keep things running.",
        effect:{approval:3,economy:2}, facEffect:{congress:10,media:4}, capitalCost:15 },
      { title:"Let it burn", desc:"Hold your ground. Blame Congress.",
        effect:{approval:-6,economy:-8}, facEffect:{congress:-10,media:-5,wallst:-8} }
    ]},
  { title:"Military Coup Rumors", desc:"Intel reports generals discussing your removal. Pentagon denies it.",
    options:[
      { title:"Fire the generals", desc:"Clean house. Assert civilian control.",
        effect:{approval:3,security:-10,liberty:-5}, facEffect:{military:-20,congress:-5} },
      { title:"Meet privately", desc:"Negotiate behind closed doors.",
        effect:{approval:-2,security:3}, facEffect:{military:8,congress:2} }
    ]},
  { title:"Pandemic Outbreak", desc:"New virus. Millions watching. What's the call?",
    options:[
      { title:"Full lockdown", desc:"Flatten the curve. Crush the economy.",
        effect:{approval:3,economy:-15,security:5,liberty:-12}, facEffect:{media:8,wallst:-12,congress:-3} },
      { title:"Stay open", desc:"Protect the economy. Let states decide.",
        effect:{approval:-3,economy:5,security:-5,liberty:10}, facEffect:{media:-10,wallst:8,congress:3} }
    ]},
  { title:"Nuclear Threat", desc:"North Korea launches an ICBM. Splashes 200 miles from Hawaii.",
    options:[
      { title:"Military strike", desc:"Destroy their launch sites. Overwhelming force.",
        effect:{approval:8,economy:-10,security:12,liberty:-5}, facEffect:{military:15,media:-5,wallst:-10,congress:5} },
      { title:"Diplomatic response", desc:"UN sanctions. De-escalation.",
        effect:{approval:-5,economy:-2,security:-8,liberty:5}, facEffect:{military:-10,media:8,wallst:3,congress:3} }
    ]},
  { title:"Whistleblower Bombshell", desc:"Former cabinet member leaks docs. It's everywhere.",
    options:[
      { title:"Full transparency", desc:"Release everything. Take the hit.",
        effect:{approval:-5,liberty:8}, facEffect:{media:10,congress:5} },
      { title:"Discredit the leaker", desc:"Attack their credibility. Control the narrative.",
        effect:{approval:3,liberty:-8}, facEffect:{media:-10,congress:-3} }
    ]},
  { title:"Impeachment Proceedings", desc:"The House has the votes. Formal hearings begin.",
    options:[
      { title:"Fight publicly", desc:"Go on every network. Rally the base.",
        effect:{approval:5,security:-3}, facEffect:{congress:-12,media:-5}, capitalCost:12 },
      { title:"Cooperate", desc:"Provide documents. Let truth defend you.",
        effect:{approval:-8,liberty:5}, facEffect:{congress:8,media:6} }
    ]},
];

// ==================== SABOTAGE ====================
const SABOTAGE = {
  congress: [
    { title:"Congress Blocks Your Agenda", text:"Congressional leaders refuse to bring your priorities to a vote.", effect:{approval:-4} },
    { title:"Subpoena Flood", text:"Six simultaneous investigations launched.", effect:{approval:-6,liberty:-3} },
  ],
  media: [
    { title:"Coordinated Hit Piece", text:"Negative coverage runs 24/7 for a week straight.", effect:{approval:-8} },
    { title:"Leaked Audio", text:"Out-of-context audio from a private meeting goes viral.", effect:{approval:-10} },
  ],
  military: [
    { title:"Joint Chiefs Revolt", text:"Pentagon brass publicly disagrees with your strategy.", effect:{security:-8,approval:-4} },
    { title:"Failed Operation", text:"Military op goes wrong. They blame your leadership.", effect:{security:-10,approval:-6} },
  ],
  wallst: [
    { title:"Coordinated Selloff", text:"Wall Street dumps stocks to pressure your policies.", effect:{economy:-10,approval:-4} },
    { title:"Credit Downgrade", text:"Rating agencies downgrade US debt.", effect:{economy:-12,approval:-5} },
  ],
};

// ==================== STATE ====================
let state = {};
let toastTimer = null;

function initState() {
  return {
    approval:60, economy:50, security:50, liberty:50,
    factions:{congress:50,media:40,military:55,wallst:50},
    budget:100, day:1, term:1, signed:0, vetoed:0, crisesHandled:0,
    orderQueue:[], pendingChains:[], playing:false,
    electionDay:100, decayRate:0,
    sabotageCD:{congress:0,media:0,military:0,wallst:0},
    phase:'advisor1', // advisor1 -> advisor2 -> order
    currentAdvisors:[], currentOrder:null,
  };
}

// ==================== STARFIELD ====================
const starCanvas = document.getElementById('stars');
const starCtx = starCanvas.getContext('2d');
let stars = [];
function resizeStars() {
  starCanvas.width = window.innerWidth;
  starCanvas.height = window.innerHeight;
  stars = [];
  for (let i = 0; i < 60; i++) {
    stars.push({
      x: Math.random()*starCanvas.width, y: Math.random()*starCanvas.height,
      r: Math.random()*1.2+0.3, a: Math.random()*0.4+0.05,
      flicker: Math.random()*0.02+0.005, dir: Math.random()>0.5?1:-1
    });
  }
}
window.addEventListener('resize', resizeStars);
resizeStars();
function drawStars() {
  starCtx.clearRect(0,0,starCanvas.width,starCanvas.height);
  stars.forEach(s => {
    s.a += s.flicker * s.dir;
    if (s.a > 0.5 || s.a < 0.03) s.dir *= -1;
    starCtx.beginPath();
    starCtx.arc(s.x, s.y, s.r, 0, Math.PI*2);
    starCtx.fillStyle = `rgba(212,168,67,${s.a})`;
    starCtx.fill();
  });
  requestAnimationFrame(drawStars);
}
drawStars();

// Draw title seal
function drawTitleSeal() {
  const c = document.getElementById('title-seal');
  const ctx = c.getContext('2d');
  ctx.fillStyle = '#D4A843';
  ctx.beginPath();
  // Pentagon shape
  const cx = 50, cy = 50, r = 40;
  for (let i = 0; i < 5; i++) {
    const angle = (i * 72 - 90) * Math.PI / 180;
    const x = cx + r * Math.cos(angle);
    const y = cy + r * Math.sin(angle);
    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  }
  ctx.closePath(); ctx.fill();
  // Inner star
  ctx.fillStyle = '#0D0D12';
  ctx.beginPath();
  for (let i = 0; i < 5; i++) {
    const outerAngle = (i * 72 - 90) * Math.PI / 180;
    const innerAngle = ((i * 72 + 36) - 90) * Math.PI / 180;
    const ox = cx + 22 * Math.cos(outerAngle);
    const oy = cy + 22 * Math.sin(outerAngle);
    const ix = cx + 10 * Math.cos(innerAngle);
    const iy = cy + 10 * Math.sin(innerAngle);
    i === 0 ? ctx.moveTo(ox, oy) : ctx.lineTo(ox, oy);
    ctx.lineTo(ix, iy);
  }
  ctx.closePath(); ctx.fill();
}
drawTitleSeal();

// ==================== SCREEN ====================
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ==================== HUD ====================
function clamp(v) { return Math.max(0, Math.min(100, Math.round(v))); }

function renderHUD() {
  const stats = [
    { key:'approval', label:'Approval', color:'#D4A843' },
    { key:'economy', label:'Economy', color:'#2E86AB' },
    { key:'security', label:'Security', color:'#D35400' },
    { key:'liberty', label:'Liberty', color:'#7D3C98' },
  ];
  const row = document.getElementById('hud-row');
  row.innerHTML = stats.map(s => {
    const v = state[s.key];
    return `<div class="hud-stat">
      ${iconSVG(s.key, 16, v < 20 ? '#C0392B' : s.color)}
      <div class="hud-stat-val" style="color:${v < 20 ? '#C0392B' : s.color}">${s.key==='approval' ? v+'%' : v}</div>
      <div class="hud-stat-bar"><div class="hud-stat-fill" style="width:${v}%;background:${v<20?'#C0392B':s.color}"></div></div>
    </div>`;
  }).join('');

  document.getElementById('day-label').textContent = `DAY ${state.day}`;
  document.getElementById('term-label').textContent = `TERM ${state.term}`;
  document.getElementById('budget-label').textContent = `CAPITAL: ${state.budget}`;

  const facs = [
    { key:'congress', label:'Congress', icon:'congress' },
    { key:'media', label:'Media', icon:'media' },
    { key:'military', label:'Military', icon:'military' },
    { key:'wallst', label:'Wall St', icon:'wallst' },
  ];
  const frow = document.getElementById('faction-row');
  frow.innerHTML = facs.map(f => {
    const v = state.factions[f.key];
    const cls = v < 25 ? 'hostile' : v > 70 ? 'friendly' : '';
    const col = v < 25 ? '#C0392B' : v > 70 ? '#27AE60' : '#D4A843';
    return `<div class="faction-chip ${cls}">
      ${iconSVG(f.icon, 14, col)}
      <div class="faction-chip-name">${f.label}</div>
      <div class="faction-chip-val" style="color:${col}">${v}</div>
    </div>`;
  }).join('');
}

function updateStats(animate) {
  ['approval','economy','security','liberty'].forEach(s => { state[s] = clamp(state[s]); });
  Object.keys(state.factions).forEach(f => { state.factions[f] = clamp(state.factions[f]); });
  renderHUD();
}

// ==================== TOAST ====================
function showToast(title, text, dur) {
  if (toastTimer) clearTimeout(toastTimer);
  const t = document.getElementById('toast');
  document.getElementById('toast-title').textContent = title;
  document.getElementById('toast-text').textContent = text;
  t.style.transition = 'opacity 0.3s, transform 0.3s';
  t.classList.add('show');
  toastTimer = setTimeout(() => { t.classList.remove('show'); }, dur || 2200);
}

// ==================== GAME FLOW ====================
function shuffleOrders() {
  const arr = [...ORDERS];
  for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; }
  return arr;
}

function nextTurn() {
  if (!state.playing) return;
  if (state.orderQueue.length === 0) state.orderQueue = shuffleOrders();
  const order = state.orderQueue.pop();
  state.currentOrder = order;
  state.currentAdvisors = pickAdvisors(order);
  state.phase = 'advisor1';
  showAdvisor(0);
}

function showAdvisor(idx) {
  const adv = state.currentAdvisors[idx];
  const content = document.getElementById('game-content');

  const portraitCanvas = document.createElement('canvas');
  portraitCanvas.width = 120; portraitCanvas.height = 120;
  drawLowPolyHead(portraitCanvas, adv.palette, adv.seed);

  content.innerHTML = '';
  const view = document.createElement('div');
  view.className = 'advisor-view';
  view.innerHTML = `
    <div class="advisor-portrait"></div>
    <div class="advisor-speech">
      <div class="advisor-speech-text">"${adv.quote}"</div>
    </div>
    <div class="advisor-info">
      <div class="advisor-info-name">${adv.name}</div>
      <div class="advisor-info-title">${adv.title}</div>
    </div>
    <button class="btn-continue" onclick="${idx === 0 ? 'showAdvisor(1)' : 'showOrderCard()'}">${idx === 0 ? 'NEXT ADVISOR' : 'VIEW ORDER'}</button>
  `;
  content.appendChild(view);
  view.querySelector('.advisor-portrait').appendChild(portraitCanvas);

  // Animate in
  view.style.opacity = '0';
  view.style.transform = 'translateY(20px)';
  requestAnimationFrame(() => {
    view.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
    view.style.opacity = '1';
    view.style.transform = 'translateY(0)';
  });
}

function showOrderCard() {
  const order = state.currentOrder;
  const canAfford = state.budget >= order.cost;
  const content = document.getElementById('game-content');

  const effectsHTML = Object.entries(order.sign).filter(([k,v]) => v !== 0).map(([k,v]) => {
    return `<span class="order-card-effect ${v>0?'pos':'neg'}">${v>0?'+':''}${v} ${k.charAt(0).toUpperCase()+k.slice(1)}</span>`;
  }).join('');

  const iconCanvas = catIconCanvas(order.cat);

  const view = document.createElement('div');
  view.className = 'order-view';
  view.innerHTML = `
    <div class="order-card-wrap">
      <div class="order-card" id="current-card">
        <div class="order-card-top">
          <div class="order-card-icon"></div>
          <div>
            <div class="order-card-cat">${order.cat}</div>
            <div class="order-card-title">${order.title}</div>
          </div>
        </div>
        <div class="order-card-body">
          <div class="order-card-desc">${order.desc}</div>
          <div class="order-card-cost">${iconSVG('capital',12,'#2E86AB')} ${order.cost} Capital</div>
          <div class="order-card-effects">${effectsHTML}</div>
        </div>
        <div class="order-card-actions">
          <button class="btn-order sign" onclick="decide('sign')" ${!canAfford?'disabled':''}>SIGN${!canAfford?' ('+order.cost+')':''}</button>
          <button class="btn-order veto" onclick="decide('veto')">VETO</button>
        </div>
      </div>
    </div>
  `;
  content.innerHTML = '';
  content.appendChild(view);
  view.querySelector('.order-card-icon').appendChild(iconCanvas);

  view.style.opacity = '0';
  view.style.transform = 'translateY(20px)';
  requestAnimationFrame(() => {
    view.style.transition = 'opacity 0.35s ease, transform 0.35s ease';
    view.style.opacity = '1';
    view.style.transform = 'translateY(0)';
  });
}

// ==================== DECIDE ====================
function decide(action) {
  const order = state.currentOrder;
  const effects = action === 'sign' ? order.sign : order.veto;
  const facEffects = action === 'sign' ? (order.signFac||{}) : (order.vetoFac||{});
  const eventText = action === 'sign' ? order.signEvent : order.vetoEvent;

  if (action === 'sign') {
    state.budget -= order.cost;
    state.signed++;
    if (order.chain) state.pendingChains.push({ ...order.chain, triggerDay: state.day + order.chain.delay });
  } else {
    state.vetoed++;
  }

  Object.entries(effects).forEach(([k,v]) => { state[k] += v; });
  Object.entries(facEffects).forEach(([k,v]) => { state.factions[k] += v; });

  const card = document.getElementById('current-card');
  if (card) {
    const dir = action === 'sign' ? 1 : -1;
    card.style.transition = 'transform 0.35s ease, opacity 0.35s ease';
    card.style.transform = `translateX(${dir*300}px) rotate(${dir*10}deg)`;
    card.style.opacity = '0';
    setTimeout(() => advanceDay(eventText), 400);
  } else {
    advanceDay(eventText);
  }
}

function advanceDay(eventText) {
  updateStats(true);
  showToast(eventText.includes('!') ? 'BREAKING' : 'RESULT', eventText);

  setTimeout(() => {
    if (checkGameOver()) return;

    // Chains
    const triggered = state.pendingChains.filter(c => state.day >= c.triggerDay);
    state.pendingChains = state.pendingChains.filter(c => state.day < c.triggerDay);
    if (triggered.length > 0) {
      processChains(triggered, 0, () => afterChains());
    } else {
      afterChains();
    }
  }, 1000);
}

function processChains(chains, idx, cb) {
  if (idx >= chains.length) return cb();
  const c = chains[idx];
  Object.entries(c.effect).forEach(([k,v]) => { state[k] += v; });
  if (c.facEffect) Object.entries(c.facEffect).forEach(([k,v]) => { state.factions[k] += v; });
  updateStats(true);
  showToast('CHAIN REACTION: ' + c.title, c.text, 2800);
  setTimeout(() => { if (!checkGameOver()) processChains(chains, idx+1, cb); }, 2200);
}

function afterChains() {
  // Sabotage
  let sabotaged = false;
  for (const [fac, loyalty] of Object.entries(state.factions)) {
    if (loyalty < 20 && state.sabotageCD[fac] <= 0 && Math.random() < 0.4) {
      const s = SABOTAGE[fac][Math.floor(Math.random()*SABOTAGE[fac].length)];
      Object.entries(s.effect).forEach(([k,v]) => { state[k] += v; });
      updateStats(true);
      state.sabotageCD[fac] = 5;
      showToast(fac.toUpperCase() + ' SABOTAGE', s.text, 2500);
      sabotaged = true;
      break;
    }
  }
  Object.keys(state.sabotageCD).forEach(k => { if (state.sabotageCD[k] > 0) state.sabotageCD[k]--; });

  setTimeout(() => {
    if (checkGameOver()) return;
    if (state.day > 5 && state.day % (7+Math.floor(Math.random()*5)) === 0 && Math.random() < 0.6) {
      return triggerCrisis();
    }
    if (state.day === state.electionDay && state.term === 1) {
      return triggerElection();
    }
    proceedNext();
  }, sabotaged ? 2000 : 200);
}

function proceedNext() {
  state.day++;
  state.decayRate = Math.min(2.5, 0.2 + state.day * 0.015);
  const stats = ['approval','economy','security','liberty'];
  const weights = stats.map(s => state[s]);
  const total = weights.reduce((a,b)=>a+b,0);
  if (total > 0) {
    let r = Math.random() * total;
    for (let i = 0; i < stats.length; i++) {
      r -= weights[i]; if (r <= 0) { state[stats[i]] -= state.decayRate; break; }
    }
  }
  state.approval -= 0.3;
  state.budget = Math.min(150, state.budget + Math.max(2, 6 - Math.floor(state.day/20)));
  if (state.term === 2) { state.approval -= 0.4; if (state.day > 160) state.approval -= 0.3; }
  updateStats(false);
  nextTurn();
}

// ==================== CRISIS ====================
function triggerCrisis() {
  const crisis = CRISES[Math.floor(Math.random()*CRISES.length)];
  state.crisesHandled++;
  state.currentCrisis = crisis;

  document.getElementById('crisis-title').textContent = crisis.title;
  document.getElementById('crisis-desc').textContent = crisis.desc;
  document.getElementById('crisis-options').innerHTML = crisis.options.map((o,i) => `
    <div class="overlay-option" onclick="resolveCrisis(${i})">
      <div class="overlay-option-title">${o.title}</div>
      <div class="overlay-option-desc">${o.desc}</div>
    </div>
  `).join('');

  document.getElementById('crisis-overlay').classList.add('active');
}

function resolveCrisis(idx) {
  const opt = state.currentCrisis.options[idx];
  Object.entries(opt.effect).forEach(([k,v]) => { state[k] += v; });
  if (opt.facEffect) Object.entries(opt.facEffect).forEach(([k,v]) => { state.factions[k] += v; });
  if (opt.capitalCost) state.budget = Math.max(0, state.budget - opt.capitalCost);
  document.getElementById('crisis-overlay').classList.remove('active');
  updateStats(true);
  showToast('CRISIS RESOLVED', opt.title, 2000);
  setTimeout(() => { if (!checkGameOver()) proceedNext(); }, 1200);
}

// ==================== ELECTION ====================
function triggerElection() {
  const score = state.approval*0.4 + state.economy*0.25 + state.security*0.15 + state.liberty*0.1
    + (state.factions.congress*0.05 + state.factions.media*0.05);
  const win = score > 35;
  const margin = Math.abs(score - 35);

  const card = document.getElementById('election-card');
  const sealCanvas = document.createElement('canvas');
  sealCanvas.width = 80; sealCanvas.height = 80;
  const sCtx = sealCanvas.getContext('2d');
  sCtx.fillStyle = win ? '#D4A843' : '#C0392B';
  sCtx.beginPath();
  for (let i = 0; i < 5; i++) {
    const a = (i*72-90)*Math.PI/180;
    const x = 40 + 30*Math.cos(a), y = 40 + 30*Math.sin(a);
    i===0 ? sCtx.moveTo(x,y) : sCtx.lineTo(x,y);
  }
  sCtx.closePath(); sCtx.fill();

  if (win) {
    card.innerHTML = `
      <div class="election-title">RE-ELECTED</div>
      <div class="election-desc">The people chose you again. Four more years.</div>
      <div class="election-result">${Math.min(62,50+Math.round(margin*0.4))}% - ${Math.max(38,50-Math.round(margin*0.4))}%</div>
      <div class="election-sub">ELECTORAL COLLEGE VICTORY</div>
      <button class="btn-play" onclick="startTerm2()">BEGIN TERM 2</button>
    `;
  } else {
    card.innerHTML = `
      <div class="election-title" style="color:var(--red)">DEFEATED</div>
      <div class="election-desc">The voters chose someone else.</div>
      <div class="election-result">${Math.max(38,50-Math.round(margin*0.4))}% - ${Math.min(62,50+Math.round(margin*0.4))}%</div>
      <div class="election-sub">ELECTORAL COLLEGE DEFEAT</div>
      <button class="btn-play" onclick="showGameOver('DEFEATED','Lost re-election. The voters wanted change.')">ACCEPT RESULTS</button>
    `;
  }
  card.prepend(sealCanvas);
  document.getElementById('election-overlay').classList.add('active');
}

function startTerm2() {
  document.getElementById('election-overlay').classList.remove('active');
  state.term = 2;
  state.budget += 30;
  state.approval = Math.min(100, state.approval + 10);
  Object.keys(state.factions).forEach(f => { state.factions[f] = Math.min(100, state.factions[f]+10); });
  updateStats(true);
  showToast('TERM 2', 'Difficulty increased. The clock is ticking.', 2500);
  setTimeout(() => proceedNext(), 1500);
}

// ==================== GAME OVER ====================
function checkGameOver() {
  let reason='', title='';
  if (state.approval <= 0) { title='VOTED OUT'; reason='Approval hit zero. The people have spoken.'; }
  else if (state.economy <= 0) { title='ECONOMIC COLLAPSE'; reason='Markets crashed. Banks failed. You did this.'; }
  else if (state.security <= 0) { title='NATIONAL CRISIS'; reason='Security collapsed. The nation is vulnerable.'; }
  else if (state.liberty <= 0) { title='IMPEACHED'; reason='You became a tyrant. The Court removed you.'; }
  if (state.term === 2 && state.day >= 200 && !reason) { title='LEGACY SECURED'; reason='Two full terms. History will judge you.'; }
  if (!reason && !(state.term===2 && state.day>=200)) return false;
  state.playing = false;
  showGameOver(title, reason);
  return true;
}

function showGameOver(title, reason) {
  state.playing = false;
  document.getElementById('crisis-overlay').classList.remove('active');
  document.getElementById('election-overlay').classList.remove('active');
  document.getElementById('go-title').textContent = title;
  document.getElementById('go-reason').textContent = reason;
  document.getElementById('go-stats').innerHTML = [
    { v: state.day, l: 'Days' }, { v: state.signed, l: 'Signed' },
    { v: state.vetoed, l: 'Vetoed' }, { v: state.crisesHandled, l: 'Crises' },
    { v: state.term, l: 'Term' },
  ].map(s => `<div class="go-stat"><div class="go-stat-val">${s.v}</div><div class="go-stat-lbl">${s.l}</div></div>`).join('');
  setTimeout(() => showScreen('gameover-screen'), 500);
}

// ==================== START ====================
function startGame() {
  state = initState();
  state.orderQueue = shuffleOrders();
  state.playing = true;
  updateStats(false);
  showScreen('game-screen');
  nextTurn();
}
</script>
</body>
</html>
